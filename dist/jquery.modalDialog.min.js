!function(a){a.modalDialog=a.modalDialog||{};var b,c=a.modalDialog._ua=function(){var a=navigator.userAgent;return a.indexOf("MSIE 7.0")>0?{ie:!0,ie7:!0,version:7,compat:a.indexOf("compatible")>0}:a.indexOf("MSIE 8.0")>0?{ie:!0,ie8:!0,version:8,compat:a.indexOf("compatible")>0}:{}}();a.modalDialog.setSmallScreen=function(a){b=a},a.modalDialog.isSmallScreen=function(){if("undefined"!=typeof b)return b;if(c.ie7||c.ie8)return!1;var d=a(window).width();return("number"==typeof window.orientation?Math.min(d,a(window).height()):d)<=480}}(jQuery),Object.keys||(Object.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&(b[b.length]=c);return b}),function(a){var b="data-dialog-",c=function(a){return a||null},d=function(a){if(a)switch(a=a.toString().toLowerCase()){case"true":case"yes":case"1":return!0}return!1},e=function(a){return a?new Function("event",a):null},f={title:c,onopen:e,onbeforeopen:e,onclose:e,onbeforeclose:e,maxWidth:parseInt,initialHeight:parseInt,ajax:d,onajaxerror:e,destroyOnClose:d,skin:c,enableHistory:d,zIndex:parseInt};a.modalDialog=a.modalDialog||{},a.modalDialog.getSettings=function(c){var d={};return a.each(Object.keys(f),function(a,e){var g=c.attr(b+e);if("undefined"!=typeof g){var h=f[e];d[e]=h(g)}}),d}}(jQuery),function(a){if(a.modalDialog&&a.modalDialog._isContent)throw new Error("Attempt to load jquery.modalDialogContent.js in the same window as jquery.modalDialog.js.");var b=10,c="-700px",d=[],e={};a.modalDialog.defaults={zIndex:1e4,title:"",maxWidth:600,initialHeight:100,skin:"primary",ajax:!1,url:null,content:null,destroyOnClose:!1,containerElement:"body",preventEventBubbling:!0,enableHistory:!0,onopen:null,onclose:null,onbeforeopen:null,onbeforeclose:null,onajaxerror:null};var f=a.fn.transition?"transition":"animate",g=a.fn.transition?"out":"swing",h=a.modalDialog._ua;a.modalDialog.iframeLoadTimeout=0,a.modalDialog.animationDuration=600;var i=function(b){this.settings=b,this.parent=a(this.settings.containerElement||"body"),a.each(["open","beforeopen","close","beforeclose","ajaxerror"],a.proxy(this._setupCustomEvent,this)),a.proxyAll(this,"_drag","_startDrag","_stopDrag","_close","_keydownHandler")};i.prototype.dialogType="node",i.prototype._setupCustomEvent=function(b,c){var d="on"+c,e=a.CustomEvent.create(this,c),f=this.settings[d];return f&&e.add(f),e},i.prototype._initDeferred=function(b,c){return this._deferreds=this._deferreds||{},c=c||new a.Deferred,this._deferreds[b]=c,c},i.prototype._completeDeferred=function(a,b,c){var d=this._deferreds[a];if(d)return d[b+"With"](this,c),d;throw new Error("No deferred initialized for action '"+a+"'")},i.prototype._resolveDeferred=function(a,b){return this._completeDeferred(a,"resolve",b)},i.prototype._rejectDeferred=function(a,b){return this._completeDeferred(a,"reject",b)},i.prototype._clearDeferred=function(a){this._deferreds[a]=null},i.prototype._getDeferred=function(a){return this._deferreds[a]},i.prototype._isDeferredComplete=function(a){var b=this._getDeferred(a);return!b||"pending"!=b.state()},i.prototype.isOpen=function(){return!!this._open},i.prototype.open=function(){var b=this._initDeferred("open",b);if(this._open)return this._rejectDeferred("open");this.level=d.length;var e=this.onbeforeopen.fire();return e.isDefaultPrevented()?this._rejectDeferred("open"):(e=a.modalDialog.onbeforeopen.fire(null,this),e.isDefaultPrevented()?this._rejectDeferred("open"):(d.push(this),this.level>0&&(this.settings.parentId=d[this.level-1].settings._fullId),this._open=!0,this._build(),this.$container[a.modalDialog.isSmallScreen()?"addClass":"removeClass"]("smallscreen"),this.$container.stop(!0,!0),this.$el.show(),this._showLoadingIndicator(),a(document).on("keydown",this._keydownHandler),this._finishOpenAction=function(){if("rejected"!=b.state()){this.$bg.addClass(a.modalDialog.veilClass);var d=this._getDefaultWidthData();this.$container.css({width:d.width});var e=this._getDefaultPosition(),h=e.top;e.top=c,this.$container.css(e);var i=a.proxy(function(){try{this.$el.addClass("dialog-visible"),a.modalDialog.isSmallScreen()&&(this.triggerWindowResize=!1,this._orientationchange=a.proxy(function(a){return this.triggerWindowResize=!0,this.pos(a)},this),a(window).on("orientationchange resize",this._orientationchange)),this.onopen.fire(),a.modalDialog.onopen.fire(null,this),this._resolveDeferred("open")}catch(b){this._rejectDeferred("open",b)}this._clearDeferred("open")},this);this.$container[f]({top:h},a.modalDialog.animationDuration,g).promise().then(i,i)}else this._clearDeferred("open");this._hideLoadingIndicator()},this._finishOpen(),b.promise()))},i.prototype._finishOpen=function(){if(this._finishOpenAction){try{this._finishOpenAction()}catch(a){this._rejectDeferred("open",a),this._clearDeferred("open")}this._finishOpenAction=null}},i.prototype._keydownHandler=function(b){27==b.keyCode&&a.modalDialog.getCurrent()===this&&this.cancel()},i.prototype.cancel=function(){this.$container&&this.$container.stop(!0,!1),this.isOpen()&&this.close()},i.prototype._showLoadingIndicator=function(){this.$loadingIndicator||(this.$loadingIndicator=a("<div class='dialog-loading-indicator'><span></span></div>").appendTo(this.$bg))},i.prototype._hideLoadingIndicator=function(){this.$loadingIndicator.remove(),this.$loadingIndicator=null},i.prototype._popDialogStack=function(){a.modalDialog.getCurrent()===this&&d.pop()},i.prototype.close=function(b){var d=this._initDeferred("close",d);if(a.modalDialog.getCurrent()!==this)throw new Error("Can't close a dialog that isn't currently displayed on top.");var e={isDialogCloseButton:!!b};return this.onbeforeclose.fire(e).isDefaultPrevented()?this._rejectDeferred("close"):a.modalDialog.onbeforeclose.fire(e,this).isDefaultPrevented()?this._rejectDeferred("close"):(this._popDialogStack(),a(document).off("keydown",this._keydownHandler),this.$el.removeClass("dialog-visible"),this.$container[f]({top:c},a.modalDialog.animationDuration,g).promise().then(a.proxy(function(){try{this._finishClose(e)}catch(a){this._rejectDeferred("close",a),this._clearDeferred("close")}},this),a.proxy(function(a){this._rejectDeferred("close",a),this._clearDeferred("close")},this)),this._orientationchange&&a(window).off("orientationchange resize",this._orientationchange),d.promise())},i.prototype._close=function(a){a.preventDefault(),this.close(!0)},i.prototype._reset=function(){this._open=!1,this.$container.stop(!0,!0),this.$container.css({top:c}),this.$bg.removeClass(a.modalDialog.veilClass),this.$el.hide()},i.prototype._resetFailed=function(){this._reset(),this._popDialogStack()},i.prototype._finishClose=function(b){this._reset(),this.settings.destroyOnClose&&(this._destroy(),this._destroyed=!0,delete e[this.settings._fullId]),a.modalDialog.isSmallScreen()&&this.triggerWindowResize&&a(window).trigger("resize"),setTimeout(a.proxy(function(){this.onclose.fire(b),a.modalDialog.onclose.fire(b,this),this._resolveDeferred("close")},this),0)},i.prototype._destroy=function(){this.$content.detach().appendTo("body"),this.$el.remove()},i.prototype._updateZIndexes=function(){var a=this.settings.zIndex,b=this.getParent();b&&(a=Math.max(b.settings.zIndex+10,a)),this.$bg.css("z-index",a),a+=2,this.$container.css("z-index",a)},i.prototype._build=function(){if(this._destroyed)throw new Error("This dialog has been destroyed");this.$el?this._alreadyBuilt():(this.$bg=a('<div class="dialog-background"></div>'),this.$container=a('<div class="dialog-container" id="'+this.settings._fullId+'Container">'+'  <div class="dialog-header">'+'    <a href="#" class="dialog-close-button"><span class="dialog-close-button-icon"></span></a>'+"    <h1>"+this.settings.title+"</h1>"+"  </div>"+'  <div class="dialog-content-container">'+"  </div>"+"</div>"),this.$el=a([this.$bg[0],this.$container[0]]).addClass("dialog-skin-"+this.settings.skin),this.parent.append(this.$bg,this.$container),this.parent.is("body")||this.parent.hasClass("ui-page-active")||(this.$bg.css("position","absolute"),"static"==this.parent.css("position")&&this.parent.css("position","relative")),this.$contentContainer=this.$el.find(".dialog-content-container"),this.$header=this.$el.find(".dialog-header"),this.$closeButton=this.$el.find(".dialog-close-button").on("click",this._close),this._buildContent(),this.$content.find('*[data-action="close"]').on("click",this._close),this.$contentContainer.append(this.$content),!this.parent.is("body")&&!this.parent.hasClass("ui-page-active")||h.ie7||this._makeDraggable()),this._updateZIndexes()},i.prototype._alreadyBuilt=function(){},i.prototype._getChromeHeight=function(){return this._chromeHeight||(this._chromeHeight=this.$container.height()-this.$content.height()),this._chromeHeight},i.prototype._getDefaultWidthData=function(){var c=a(window),d=this.parent.is("body")?window.innerWidth||c.width():this.parent.width();return{windowWidth:d,width:Math.min(d-2*b,this.settings.maxWidth)}},i.prototype._getDefaultPosition=function(c){var d=this._getDefaultWidthData(),e=a(document).scrollTop(),f={width:d.width,top:e+b};f.left=(d.windowWidth-f.width)/2;var g=a.modalDialog.isSmallScreen();if((h.ie7||g)&&(f.top=b),!g){c=c||this.$content.height();var i=this._getChromeHeight()+c,j=this.parent.is("body")?a(window).height():this.parent.height(),k=j/2-i/2+e;f.top=Math.max(k,f.top)}return f},i.prototype._makeDraggable=function(){a.modalDialog.isSmallScreen()||this.$header.addClass("draggable").on("pointerdown",this._startDrag)},i.prototype._startDrag=function(b){var c=a(b.target);if(!c.is(this.$closeButton)&&!c.is(this.$closeButton.children())){if(b.stopPropagation(),b.preventDefault(),this._initialMousePos=j(b),this._initialDialogPos=this.$container.offset(),this.$bg.on("pointermove",this._drag),this.$container.on("pointermove",this._drag),this.$bg.on("pointerup",this._stopDrag),this.$container.on("pointerup",this._stopDrag),this.$frame)try{this.$frame.iframeDocument().find("body").on("pointermove",this._drag).on("pointerup",this._stopDrag)}catch(d){}this._parentRect=this.$el.clientRect(),this._isDragging=!0}},i.prototype._drag=function(a){a.preventDefault(),a.stopPropagation();var b=j(a),c=b.top-this._initialMousePos.top,d=b.left-this._initialMousePos.left,e={top:this._initialDialogPos.top+c,left:this._initialDialogPos.left+d};this.$container.css(e)},i.prototype._stopDrag=function(a){if(this._initialMousePos=null,this._initialDialogPos=null,a.stopPropagation(),a.preventDefault(),this.$bg.off("pointermove",this._drag),this.$container.off("pointermove",this._drag),this.$bg.off("pointerup",this._stopDrag),this.$container.off("pointerup",this._stopDrag),this.$frame)try{this.$frame.iframeDocument().find("body").off("pointermove",this._drag).off("pointerup",this._stopDrag)}catch(b){}this._isDragging=!1};var j=function(b){var c={left:b.clientX,top:b.clientY};if(b.target.ownerDocument!=window.document){var d=a(b.target.ownerDocument).hostIframe();if(d.length>0){var e=d.clientRect();c.top+=e.top,c.left+=e.left}}return c};i.prototype._buildContent=function(){this.$content=a(this.settings.content),this.$content.detach()},i.prototype.getWindow=function(){return window},i.prototype.getParent=function(){return this.settings.parentId?r(this.settings.parentId):null},i.prototype.center=function(){var a=this._getDefaultPosition();this.$container[f]({top:a.top},400)},i.prototype.pos=function(a){this.$container.stop(!0,!0);var b=this._getDefaultPosition();if(a===!0){var c=b.top;delete b.top,this.$container.css(b)[f]({top:c},400)}else this.$container.css(b)},i.prototype.setTitle=function(a){this.$container.find(".dialog-header h1").text(a)},i.prototype.getTitle=function(){return this.$container.find(".dialog-header h1").text()};var k=function(){i.apply(this,arguments),this.settings.parentId&&(this._parentWindow=window.frames[this.settings.parentId])};a.extend(k.prototype,i.prototype),k.prototype.dialogType="iframe",k.prototype._setupCustomEvent=function(){var a=i.prototype._setupCustomEvent.apply(this,arguments);a.add(l)};var l=function(b){for(var c=0;c<d.length;c++)d[c]._postCommand&&d[c]._postCommand("event"+b.type,a.extend({_eventDialogId:this.settings._fullId},b.data))};k.prototype._finishClose=function(a){i.prototype._finishClose.call(this,a),this.$frame.remove()},k.prototype._destroy=function(){this.$el.remove()},k.prototype._buildContent=function(){this._iframeLoadTimer=null,this.$frame&&this.$frame.length>0&&this.$frame.remove(),this.$frame=a('<iframe src="'+this.settings.url+'" name="'+this.settings._fullId+'" seamless allowtransparency="true" width="100%" style="height:'+this.settings.initialHeight+'px;" class="dialog-frame" scrolling="no" frameborder="0" framespacing="0"></iframe>'),a.modalDialog.iframeLoadTimeout>0&&this.$frame.on("load",a.proxy(function(){this._isDeferredComplete("open")||(this._iframeLoadTimer=setTimeout(a.proxy(function(){this._isDeferredComplete("open")||(this.$frame.remove(),this._resetFailed(),this._rejectDeferred("open",[{message:"iframe load timeout for url: "+this.settings.url}]))},this),a.modalDialog.iframeLoadTimeout))},this)),this.$content=this.$frame},k.prototype._alreadyBuilt=function(){this._buildContent(),this.$contentContainer.append(this.$content)},k.prototype.getWindow=function(){return this.$frame.iframeWindow()[0]},k.prototype._postCommand=function(b,c){var d={dialogCmd:b};c&&a.extend(d,c);var e=a.param(d);this.postMessage(e)},k.prototype.postMessage=function(b){var c=this.getWindow(),d=this.settings.frameHostname;d||(d=0===this.settings.url.indexOf("http")?this.settings.url:document.location.href),a.postMessage?a.postMessage(b,d,c):c.postMessage(b,"*")},k.prototype.setHeight=function(a,b,c){var d=c?function(a,b){a.css(b)}:function(a,b){a.animate(b,{duration:400})};if(d(this.$content,{height:a}),b){var e=this._getDefaultPosition(a);d(this.$content,{top:e.top})}this.settings.initialHeight=a},k.prototype.setHeightFromContent=function(a,b){this._postCommand("setHeightFromContent",{center:!!a,skipAnimation:!!b})},k.prototype.setTitleFromContent=function(){this._postCommand("setTitleFromContent")},k.prototype.notifyReady=function(a){this._iframeLoadTimer&&(clearTimeout(this._iframeLoadTimer),this._iframeLoadTimer=null),this.settings.frameHostname=a,i.prototype._finishOpen.apply(this)},k.prototype._finishOpen=function(){};var m=function(){i.apply(this,arguments)};a.extend(m.prototype,i.prototype),m.prototype.dialogType="ajax",m.prototype.open=function(){var b=i.prototype.open.apply(this,arguments);return this._ajaxComplete?i.prototype._finishOpen.call(this):this.$content.partialLoad(this.settings.url,null,a.proxy(function(b,c,d){this._ajaxComplete=!0,d.fail(a.proxy(function(){this._resetFailed();var a={xhr:d,status:c,responseText:b};this.onajaxerror.fire(a),this._rejectDeferred("open",[a])},this));var e=this.$content.find("title");this.settings.title||e.length>=0&&this.setTitle(e.text()),e.remove(),i.prototype._finishOpen.call(this)},this)),b.promise()},m.prototype._finishOpen=function(){},m.prototype._buildContent=function(){this.$content=a("<div class='dialog-content'></div>")},m.prototype._destroy=function(){this.$el.remove()};var n=-1,o="dialog",p=function(a){var b=a.charAt(0);if("#"==b)return!0;if(a.indexOf("/")>=0)return!1;if("."==b){var c=a.charAt(1);return"."==c||"/"==c?!1:!0}return!1},q=function(b){var c=a.extend({},a.modalDialog.defaults);if(b.contentOrUrl&&(p(b.contentOrUrl)?b.content=a(b.contentOrUrl):b.url=b.contentOrUrl,delete b.contentOrUrl),b.content){var d=a(b.content),e=a.modalDialog.getSettings(d);a.extend(c,e)}a.extend(c,b);var f;if(c._fullId){var g=c._fullId.split("_");f=g.pop(),g.length>0&&(c.parentId=g.join("_"))}else{f=o+(c.id||++n);var h=c.parentId?c.parentId+"_":"";c._fullId=h+f}return c},r=function(a){return e[a]};a.modalDialog=a.modalDialog||{},a.modalDialog._isHost=!0,a.modalDialog.veilClass="dialog-veil",a.modalDialog.create=function(b){b=q(b);var c=r(b._fullId);if(!c&&b.content){var d=a(b.content).modalDialogInstance();if(d&&b._fullId&&d.settings._fullId!==b._fullId&&d.isOpen())throw new Error("An attempt was made to create a dialog with a content node which is already assigned to another open dialog.")}if(!c){if(b.url){if(b.content)throw new Error("Both url and content cannot be specified.");c=b.ajax?new m(b):new k(b)}else{if(!b.content)throw new Error("No url or content node specified");if(0===a(b.content).length)throw new Error("ModalDialog content not found");c=new i(b),b.destroyOnClose||a(b.content).modalDialogInstance(c)}e[b._fullId]=c}return c},a.modalDialog.getCurrent=function(){return d.length>0?d[d.length-1]:null},a.modalDialog.getExisting=function(b){var c,d=a(b.content);if(d&&d.length?c=function(b){return b.content&&a(b.content)[0]===d[0]}:b.url&&(c=function(a){return a.url&&a.url===b.url&&!!a.ajax==!!b.ajax}),c)for(var f in e){var g=e[f];if(c(g.settings))return g}return null},a.CustomEvent.create(a.modalDialog,"beforeopen"),a.CustomEvent.create(a.modalDialog,"open"),a.CustomEvent.create(a.modalDialog,"beforeclose"),a.CustomEvent.create(a.modalDialog,"close");var s="modalDialog";a.fn.modalDialogInstance=function(a){return a?this.data(s,a):this.data(s)},a.fn.modalDialog=function(b){var c;if("string"==typeof b){var d=b;c=this.modalDialogInstance(),c&&c[d]&&c[d].apply(c,Array.prototype.slice(arguments,1))}else b=b||{},b.content=this[0],c=a.modalDialog.create(b),c.open();return this};var t={setHeight:function(a,b){a.setHeight(parseInt(b.height,10),"true"===b.center,"true"===b.skipAnimation)},setTitle:function(a,b){a.setTitle(b.title)},open:function(a){a.open()},close:function(a){a.close()},create:function(){},center:function(a){a.center()},notifyReady:function(a,b){a.notifyReady(b.hostname)}},u=function(b){var c;try{c=a.deparam(b.originalEvent?b.originalEvent.data:b.data)}catch(d){}if(c&&c.dialogCmd){var e=t[c.dialogCmd];if(e){var f;return f=c._fullId?a.modalDialog.create(c):a.modalDialog.getCurrent(),e(f,c),!0}}return!1};a.receiveMessage?a.receiveMessage(u,"*"):a(window).on("message",u),window._dialogReceiveMessageManual=function(b,c){if(!u({data:b,origin:c})){var d=new a.Event("message");d.data=b,d.origin=c,a(window).trigger(d,[b,c])}},a(document).ready(function(){a.mobile&&(a.modalDialog.defaults=a.extend(a.modalDialog.defaults,{preventEventBubbling:!1}))})}(jQuery),function(a){var b="[data-dialog-main-panel='true']",c="[data-dialog-hide-onopen='true']",d=function(b,c){"iframe"==b.dialogType&&a([window,document]).enableEvent("touchmove touchstart touchend",!c)},e=function(){return window.innerHeight||a(window).height()},f=function(){var d=a(b);0===d.length&&(d=a(c));var f=0,g=0;a.modalDialog.onbeforeopen.add(function(){0===this.level&&(f=a(document).scrollTop(),g=document.body.style.height,d.each(function(b,c){a(c).data("dialog-parent",c.parentNode)}).detach(),document.body.style.height=e()+50+"px",window.scrollTo(0,1))}),a.modalDialog.onopen.add(function(){if(0===this.level){var b=Math.max(this.$container.height(),e())+20;document.body.style.height=b+"px",a(".dialog-background").css({height:b}),window.scrollTo(0,1)}}),a.modalDialog.onclose.add(function(){0===this.level&&(document.body.style.height=g,d.each(function(b,c){a(a(c).data("dialog-parent")).append(c)}),window.scrollTo(0,f))})};a(function(){if(a.modalDialog.isSmallScreen())if(a.modalDialog.veilClass="dialog-veil-opaque",a.modalDialog&&a.modalDialog._isContent){var b=a.modalDialog.getCurrent();b&&a(window).on("load",function(){d(b,!0)})}else a.modalDialog.onopen.add(function(){d(this,!0)}),a.modalDialog.onbeforeclose.add(function(){d(this,!1)}),f()})}(jQuery),function(a){var b="modalDialogUnobtrusive",c=function(c){c.preventDefault();var d=a(c.currentTarget),e=d.data(b);if(!e){var f=d.attr("href");if(!f)throw new Error("no href specified with data-rel='modalDialog'");var g={contentOrUrl:f},h=a.modalDialog.getSettings(d);a.extend(g,h);var i=new a.Event("dialogsettingscreate");if(i.dialogSettings=g,d.trigger(i),i.isDefaultPrevented())return;if(e=a.modalDialog.create(g),i=new a.Event("dialogcreate"),i.dialogSettings=g,i.dialog=e,d.trigger(i),i.isDefaultPrevented())return;d.data(b,e)}e.open()};a(document).on("click","[data-rel='modalDialog']",c),a(document).on("click",".close-dialog",function(b){b.preventDefault(),a.modalDialog.getCurrent().close()})}(jQuery),function(a){var b,c="sdialogid";a.modalDialog.enableHistory=function(d){if(!i){i=!0,b=d||c;var e=new a.Deferred;return t().then(function(){try{a.modalDialog.onopen.add(q),a.modalDialog.onclose.add(r),History.pushState(null,null,document.location.href),History.Adapter.bind(window,"statechange",s),e.resolve()}catch(b){e.reject(b)}},function(a){e.reject(a)}),e}};var d=function(){if(History.emulated.pushState&&window.location.hash){var b=window.location.hash.indexOf("?");if(b>=0)return a.deparam(window.location.hash.substr(b))}return window.location.search?a.currentQueryString():{}},e=function(a){var b=a;do{if(b&&!b.settings.enableHistory)return!1;b=b.getParent()}while(b);return i},f=!0,g=!1,h=!1,i=!1,j=function(b){var c={dialogType:"node",dialogId:null};if(b.settings.content){var d=a(b.settings.content).prop("id");if(!d)throw new Error("The specified content node has no ID, and cannot be serialized to a URL parameter.");c.dialogId="#"+d}return!c.dialogId&&b.settings.url&&(c.dialogType=b.settings.ajax?"ajax":"iframe",c.dialogId=b.settings.url),c},k=function(b){var c=null;if("iframe"==b.dialogType)c={url:b.dialogId};else if("ajax"==b.dialogType)c={ajax:!0,url:b.dialogId};else{var d;try{d=a(b.dialogId)}catch(e){}d&&d.length>0&&(c=a.modalDialog.getSettings(d),c.content=d)}return c},l=function(a,b){var c=j(b);return c.dialogType==a.dialogType&&c.dialogId==a.dialogId},m=function(a){return a.replace("#","-hash-")},n=function(a){return a.replace("-hash-","#")},o=function(b){if(!b)return[];var c=b.split(" ");return a.map(c,function(a){var b=a.indexOf(",");if(0>b)throw new Error("Invalid dialog parameters: "+a);return{dialogType:a.substr(0,b),dialogId:n(a.substr(b+1))}})},p=function(b){return a.map(b,function(a){return a.dialogType+","+m(a.dialogId)}).join(" ")},q=function(){if(!h&&e(this)){var c=j(this),i=d(),k=o(i[b]);if(this.level+1<=k.length)throw new Error("The number of dialogParams in the URL doesn't match the number of open dialogs. Not updating history.");k.push(c),i[b]=p(k);var l=a.appendQueryString(document.location.pathname,i);g=!0,History.pushState(null,null,l),f=!1}},r=function(){if(!h&&this.settings.enableHistory!==!1){if(f){var c=d(),e=o(c[b]),i=e.pop();if(!l(i,this))throw new Error("Closed dialog does not match URL parameters: "+i.dialogType+","+i.dialogId+". History not updated.");0===e.length?delete c[b]:c[b]=p(e);var j=a.appendQueryString(document.location.pathname,c);History.pushState(null,null,j)}else g=!0,History.back();f=!1}},s=function(){return g?(g=!1,void 0):(t(),void 0)},t=function(){var c=new a.Deferred,e=o(d()[b]),f=a.modalDialog.getCurrent(),g=f?f.level+1:0;e.length===g&&c.resolve();var i=function(){if(e.length>g){var b=e[g],d=k(b);if(!d)return h=!1,c.reject("Unable to create dialog settings from dialogId in URL: "+b.dialogType+","+b.dialogId),void 0;var f=a.modalDialog.getExisting(d);f||(f=a.modalDialog.create(d)),h=!0,f.open().then(function(){g++;try{i()}catch(a){c.reject(a)}})}else setTimeout(function(){c.resolve(),h=!1},0)};e.length>g&&i();var j=function(){if(e.length<g){var b=a.modalDialog.getCurrent();if(b){if(!b.settings.enableHistory)return c.resolve(),h=!1,void 0;h=!0,b.close().then(function(){g--;try{j()}catch(a){c.reject(a)}})}else h=!1,c.reject("There was a mismatch between the URL and the current open dialog stack")}else setTimeout(function(){c.resolve(),h=!1})};return e.length<g&&j(),c}}(jQuery);