!function(a){function b(b,c){if(a.proxyAll(this,"show","hide","toggle","pos","unhover","onWindowResize","onDocumentClick"),this.context=a(b).addClass("rich-tooltip-context"),this.options=a.extend({},e,c||{}),this.content=a(this.options.content).eq(0).addClass("rich-tooltip-content"),0===this.content.length)throw new Error("jquery.richTooltip: failed to find desired tooltip");if(this.content.addClass("rich-tooltip-pos-"+this.options.pos),this.content.appendTo("body"),this.context.attr("data-rel","tooltip"),"hover"===this.options.action){a.fn.hoverDelay?(this.context.hoverDelay(this.show,this.unhover,{delayOver:200,delayOut:500,addChildren:this.content}),this.content.hoverDelay(this.show,this.unhover,{delayOver:200,delayOut:500,addChildren:this.context})):(this.context.hover(this.show,this.unhover),this.content.hover(this.show,this.unhover));var d=null,f=function(a){a.preventDefault(),"touch"===a.pointerType&&(d=+new Date)};this.context.on({pointerdown:f,pointerup:a.proxy(function(a){f(a),"touch"===a.pointerType&&this.toggle(a)},this)}),this.context.on("click",a.proxy(function(a){if(null!==d){var b=+new Date-d;2500>b&&(a.preventDefault(),a.stopPropagation())}},this))}else this.context.on("click",this.toggle);this.container=this.options.container?a(this.options.container):null,this.arrow=this.content.find(".rich-tooltip-arrow"),0===this.arrow.length&&(this.arrow=a('<div class="rich-tooltip-arrow"><div class="hack" /></div>').appendTo(this.content)),this.content.on("click",'[data-rel="close"]',this.hide)}var c={south:"north",north:"south",east:"west",west:"east"},d=["north","south","west","east"],e={pos:"south",arrowDirection:null,arrowStyle:"outset"};b.prototype.unhover=function(){this._clearHoverTimeout(),this.hoverTimeout=setTimeout(this.hide,250)},b.prototype._clearHoverTimeout=function(){this.hoverTimeout&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=null)},b.prototype.show=function(){this._clearHoverTimeout(),this.visible||(a(document).trigger("closeEverything",this),this.content.show(),this.pos(),this.visible=!0,this.context.addClass("rich-tooltip-open").trigger("richTooltip:open"),this.viewportSize={height:a(window).height(),width:a(window).width()},a(window).on("resize",this.onWindowResize),a(document).on("click",this.onDocumentClick),a(document).one("closeEverything",a.proxy(function(a,b){b!==this&&this.hide()},this)))},b.prototype.hide=function(){this._clearHoverTimeout(),this.visible&&(this.content.hide(),this.visible=!1,this.context.removeClass("rich-tooltip-open").trigger("richTooltip:close"),a(window).off("resize",this.onWindowResize),a(document).off("click",this.onDocumentClick),a(document).off("closeEverything",this.hide))},b.prototype.toggle=function(a){a&&(a.preventDefault(),a.stopPropagation()),this.visible?this.hide():this.show()},b.prototype.onWindowResize=function(){(a(window).height()!=this.viewportSize.height||a(window).width()!=this.viewportSize.width)&&this.hide()},b.prototype.onDocumentClick=function(b){var c=a(b.target);c.is(this.content)||c.isChildOf(this.content)||this.hide()};var f=10,g=15;b.prototype.pos=function(){var b="inset"===this.options.arrowStyle||"none"==this.arrow.css("display")?0:g,e=a.calcRestrainedPos({giveMeSomething:!0,direction:this.options.pos,content:this.content.css("max-width","100%"),context:this.context,container:this.container,reset:{margin:0},offsets:{viewport:f,vertical:b,horizontal:b}}),h=e.pos,i=this.context.clientRect(),j={};e.direction!==this.options.pos&&this.content.removeClass("rich-tooltip-pos-"+this.options.pos).addClass("rich-tooltip-pos-"+e.direction);var k=this.options.arrowDirection||c[e.direction];switch(e.direction){case"north":case"south":j.left=i.left-h.left+i.width/2-g,j["north"===e.direction?"bottom":"top"]=0;break;case"east":case"west":j.top=i.top-h.top+i.height/2-g,j["east"===e.direction?"left":"right"]=0}if("inset"===this.options.arrowStyle)switch(k){case"north":j.top+=1;break;case"east":j.left-=1;break;case"south":j.top-=1;break;case"west":j.left+=1}this.content.css(h),this.arrow.removeClass(d.join(" ")).addClass(k).css(j)},a.fn.tooltip=a.fn.richTooltip=function(c){var d=a(this),e=d.data("__tooltip");return e||(e=new b(d,c),d.data("__tooltip",e)),"string"==typeof c&&c in e&&e[c](),this},a.fn.isChildOf=function(b){for(var c=a(this).parents(),d=0;d<c.length;d++)if(a(c[d]).is(b))return!0;return!1},a(function(){a('[data-rel="tooltip"] + aside').each(function(b,c){var d=a(c),e=d.prev(),f=e.data();e.richTooltip({content:d,action:f.tooltipAction||"click",pos:f.tooltipPos||"south",container:f.tooltipContainer||void 0,arrowDirection:f.tooltipArrowDirection||null,arrowStyle:f.tooltipArrowStyle||null})}),a("[data-tooltip]").each(function(b,c){var d=a(c),e=d.data(),f=a(e.tooltip);d.richTooltip({content:f,action:e.tooltipAction||"click",pos:e.tooltipPos||"south",container:e.tooltipContainer||void 0,arrowDirection:e.tooltipArrowDirection||null,arrowStyle:e.tooltipArrowStyle||null})})})}(jQuery);