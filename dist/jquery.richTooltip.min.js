!function(a){function b(b,e){if(a.proxyAll(this,"show","hide","toggle","pos","unhover","onWindowResize","onDocumentClick"),this.context=a(b),this.options=a.extend({},d,e||{}),this.content=a(this.options.content).eq(0).addClass("rich-tooltip-content"),0===this.content.length)throw new Error("jquery.richTooltip: failed to find desired tooltip");if(this.content.addClass("rich-tooltip-pos-"+this.options.pos),this.content.appendTo("body"),this.context.attr("data-rel","tooltip"),"hover"===this.options.action){a.fn.hoverDelay?(this.context.hoverDelay(this.show,this.unhover,{delayOver:200,delayOut:500,addChildren:this.content}),this.content.hoverDelay(this.show,this.unhover,{delayOver:200,delayOut:500,addChildren:this.context})):(this.context.hover(this.show,this.unhover),this.content.hover(this.show,this.unhover));var f=null,g=function(a){a.preventDefault(),"touch"===a.pointerType&&(f=+new Date)};this.context.on({pointerdown:g,pointerup:g}),this.context.on("click",a.proxy(function(a){if(null!==f){var b=+new Date-f;300>b&&this.toggle(a)}},this))}else this.context.on("click",this.toggle);this.container=this.options.container?a(this.options.container):null,this.arrow=this.content.find(".rich-tooltip-arrow"),0===this.arrow.length&&(this.arrow=a('<div class="rich-tooltip-arrow" />').appendTo(this.content)),this.options.arrowDirection||(this.options.arrowDirection=c[this.options.pos]),this.content.on("click",'[data-rel="close"]',this.hide)}var c={south:"north",north:"south",east:"west",west:"east"},d={pos:"south",arrowDirection:null,arrowStyle:"outset"};b.prototype.unhover=function(){this._clearHoverTimeout(),this.hoverTimeout=setTimeout(this.hide,250)},b.prototype._clearHoverTimeout=function(){this.hoverTimeout&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=null)},b.prototype.show=function(){this._clearHoverTimeout(),a(document).trigger("closeEverything"),this.content.show(),this.pos(),this.context.addClass("rich-tooltip-open"),this.viewportSize={height:a(window).height(),width:a(window).width()},a(window).on("resize",this.onWindowResize),a(window).one("scroll",this.hide),a(document).on("click",this.onDocumentClick),a(document).one("closeEverything",this.hide),this.visible=!0},b.prototype.hide=function(){this._clearHoverTimeout(),this.content.hide(),this.context.removeClass("rich-tooltip-open"),a(window).off("resize",this.onWindowResize),a(window).off("scroll",this.hide),a(document).off("click",this.onDocumentClick),a(document).off("closeEverything",this.hide),this.visible=!1},b.prototype.toggle=function(a){a&&(a.preventDefault(),a.stopPropagation()),this.visible?this.hide():this.show()},b.prototype.onWindowResize=function(){(a(window).height()!=this.viewportSize.height||a(window).width()!=this.viewportSize.width)&&this.hide()},b.prototype.onDocumentClick=function(b){var c=a(b.target);c.is(this.content)||c.isChildOf(this.content)||this.hide()};var e=10;b.prototype.pos=function(){var b=function(a){return"none"==a.arrow.css("display")||"inset"===a.options.arrowStyle?{width:0,height:0}:"east"===a.options.arrowDirection||"west"===a.options.arrowDirection?{width:15,height:25}:{width:25,height:15}}(this),d=a.calcRestrainedPos({giveMeSomething:!0,direction:this.options.pos,content:this.content.css("max-width","100%"),context:this.context,container:this.container,reset:{margin:0},offsets:{viewport:e,vertical:b.height,horizontal:b.width}}),f=d.pos,g=this.context.clientRect(),h={};d.direction!==this.options.pos&&this.content.removeClass("rich-tooltip-pos-"+this.options.pos).addClass("rich-tooltip-pos-"+d.direction);var i=this.options.arrowDirection||c[d.direction];switch(a.each(c,a.proxy(function(a,b){this.arrow.removeClass("tooltip-arrow-"+b)},this)),d.direction){case"north":case"south":h.left=g.left-f.left+g.width/2,h["north"===d.direction?"bottom":"top"]=0;break;case"east":case"west":h.top=g.top-f.top+g.height/2,h["east"===d.direction?"left":"right"]=0}if("inset"===this.options.arrowStyle)switch(i){case"north":h.top+=1;break;case"east":h.left-=1;break;case"south":h.top-=1;break;case"west":h.left+=1}this.content.css(f),this.arrow.addClass("tooltip-arrow-"+i).css(h)},a.fn.tooltip=a.fn.richTooltip=function(c){var d=a(this),e=d.data("__tooltip");e||(e=new b(d,c),d.data("__tooltip",e)),"string"==typeof c&&c in e&&e[c]()},a.fn.isChildOf=function(b){for(var c=a(this).parents(),d=0;d<c.length;d++)if(a(c[d]).is(b))return!0;return!1},a(function(){a('[data-rel="tooltip"] + aside').each(function(b,c){var d=a(c),e=d.prev().addClass("rich-tooltip-context"),f=e.data();e.richTooltip({content:d,action:f.tooltipAction||"click",pos:f.tooltipPos||"south",container:f.tooltipContainer||void 0,arrowDirection:f.tooltipArrowDirection||null,arrowStyle:f.tooltipArrowStyle||null})}),a("[data-tooltip]").each(function(b,c){var d=a(c),e=d.data(),f=a(e.tooltip);d.richTooltip({content:f,action:e.tooltipAction||"click",pos:e.tooltipPos||"south",container:e.tooltipContainer||void 0,arrowDirection:e.tooltipArrowDirection||null,arrowStyle:e.tooltipArrowStyle||null})})})}(jQuery);