!function(a){function b(b,e){if(a.proxyAll(this,"show","hide","toggle","pos","unhover","onWindowResize","onDocumentClick"),c.push(this),this.context=a(b),this.options=a.extend({},d,e||{}),this.content=a(this.options.content).eq(0).addClass("rich-tooltip-content"),0===this.content.length)throw new Error("jquery.richTooltip: failed to find desired tooltip");this.content.addClass("rich-tooltip-pos-"+this.options.pos),this.content.appendTo("body"),this.context.attr("data-rel","tooltip"),"hover"!==this.options.action||"ontouchstart"in document||navigator.pointerEnabled||navigator.msPointerEnabled?this.context.on("click",this.toggle):(this.context.hover(this.show,this.unhover),this.content.hover(this.show,this.unhover)),this.container=this.options.container?a(this.options.container):null,this.arrow=this.content.find(".rich-tooltip-arrow"),0===this.arrow.length&&(this.arrow=a('<div class="rich-tooltip-arrow" />').appendTo(this.content)),a('<span class="rich-tooltip-close textbutton textbutton-skin-secondary textbutton-round" data-rel="close"><span class="textbutton-icon textbutton-icon-delete" /></span>').appendTo(this.content),this.content.on("click",'[data-rel="close"]',this.hide)}var c=[],d={pos:"south"};b.prototype.unhover=function(){this._clearHoverTimeout(),this.hoverTimeout=setTimeout(this.hide,250)},b.prototype._clearHoverTimeout=function(){this.hoverTimeout&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=null)},b.prototype.show=function(){this._clearHoverTimeout(),c.forEach&&c.forEach(function(a){a!==this&&a.hide()},this),this.content.show(),this.pos(),this.viewportSize={height:a(window).height(),width:a(window).width()},a(window).on("resize",this.onWindowResize),a(window).one("scroll",this.hide),a(document).on("click",this.onDocumentClick),a(document).one("closeEverything",this.hide),this.visible=!0},b.prototype.hide=function(){this._clearHoverTimeout(),this.content.hide(),a(window).off("resize",this.onWindowResize),a(window).off("scroll",this.hide),a(document).off("click",this.onDocumentClick),a(document).off("closeEverything",this.hide),this.visible=!1},b.prototype.toggle=function(a){a&&(a.preventDefault(),a.stopPropagation()),this.visible?this.hide():this.show()},b.prototype.onWindowResize=function(){(a(window).height()!=this.viewportSize.height||a(window).width()!=this.viewportSize.width)&&this.hide()},b.prototype.onDocumentClick=function(b){var c=a(b.target);c.is(this.content)||c.isChildOf(this.content)||this.hide()};var e=10;b.prototype.pos=function(){var b={};"west"===this.options.pos||"east"===this.options.pos?(b.width=15,b.height=25):(b.width=25,b.height=15);var c=a.calcRestrainedPos({giveMeSomething:!0,direction:this.options.pos,content:this.content.css("max-width","100%"),context:this.context,container:this.container,reset:{margin:0},offsets:{viewport:e,vertical:b.height,horizontal:b.width}}),d=c.pos,f=this.context.clientRect(),g={};switch(c.direction!==this.options.pos&&this.content.removeClass("rich-tooltip-pos-"+this.options.pos).addClass("rich-tooltip-pos-"+c.direction),c.direction){case"north":case"south":g.left=f.left-d.left+f.width/2,g["north"===c.direction?"bottom":"top"]=0;break;case"east":case"west":g.top=f.top-d.top+f.height/2,g["east"===c.direction?"left":"right"]=0}this.content.css(d),this.arrow.css(g)},a.fn.tooltip=a.fn.richTooltip=function(c){var d=a(this),e=d.data("__tooltip");e||(e=new b(d,c),d.data("__tooltip",e)),"string"==typeof c&&c in e&&e[c]()},a.fn.isChildOf=function(b){for(var c=a(this).parents(),d=0;d<c.length;d++)if(a(c[d]).is(b))return!0;return!1},a(function(){a('[data-rel="tooltip"] + aside').each(function(b,c){var d=a(c),e=d.prev().addClass("rich-tooltip-context"),f=e.data();e.richTooltip({content:d,action:f.tooltipAction||"click",pos:f.tooltipPos||"south",container:f.tooltipContainer||void 0})}),a("[data-tooltip]").each(function(b,c){var d=a(c),e=d.data(),f=a(e.tooltip);d.richTooltip({content:f,action:e.tooltipAction||"click",pos:e.tooltipPos||"south",container:e.tooltipContainer||void 0})})})}(jQuery);