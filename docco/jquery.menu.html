<!DOCTYPE html>  <html> <head>   <title>jquery.menu.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="breakpoints.html">                 breakpoints.js               </a>                                           <a class="source" href="date-parse.html">                 date-parse.js               </a>                                           <a class="source" href="jquery.breakpoints.html">                 jquery.breakpoints.js               </a>                                           <a class="source" href="jquery.clientRect.html">                 jquery.clientRect.js               </a>                                           <a class="source" href="jquery.contentSize.html">                 jquery.contentSize.js               </a>                                           <a class="source" href="jquery.cookies.html">                 jquery.cookies.js               </a>                                           <a class="source" href="jquery.css.html">                 jquery.css.js               </a>                                           <a class="source" href="jquery.customEvent.html">                 jquery.customEvent.js               </a>                                           <a class="source" href="jquery.delimitedString.html">                 jquery.delimitedString.js               </a>                                           <a class="source" href="jquery.disableEvent.html">                 jquery.disableEvent.js               </a>                                           <a class="source" href="jquery.hostIframe.html">                 jquery.hostIframe.js               </a>                                           <a class="source" href="jquery.hoverDelay.html">                 jquery.hoverDelay.js               </a>                                           <a class="source" href="jquery.htmlEncode.html">                 jquery.htmlEncode.js               </a>                                           <a class="source" href="jquery.imageSize.html">                 jquery.imageSize.js               </a>                                           <a class="source" href="jquery.isVisibleKeyCode.html">                 jquery.isVisibleKeyCode.js               </a>                                           <a class="source" href="jquery.menu.html">                 jquery.menu.js               </a>                                           <a class="source" href="jquery-menu-exampleskin.html">                 jquery-menu-exampleskin.js               </a>                                           <a class="source" href="jquery.modalDialog.deviceFixes.html">                 jquery.modalDialog.deviceFixes.js               </a>                                           <a class="source" href="jquery.modalDialog.getSettings.html">                 jquery.modalDialog.getSettings.js               </a>                                           <a class="source" href="jquery.modalDialog.header.html">                 jquery.modalDialog.header.js               </a>                                           <a class="source" href="jquery.modalDialog.history.html">                 jquery.modalDialog.history.js               </a>                                           <a class="source" href="jquery.modalDialog.html">                 jquery.modalDialog.js               </a>                                           <a class="source" href="jquery.modalDialog.unobtrusive.html">                 jquery.modalDialog.unobtrusive.js               </a>                                           <a class="source" href="jquery.modalDialog.userAgent.html">                 jquery.modalDialog.userAgent.js               </a>                                           <a class="source" href="jquery.modalDialogContent.header.html">                 jquery.modalDialogContent.header.js               </a>                                           <a class="source" href="jquery.modalDialogContent.html">                 jquery.modalDialogContent.js               </a>                                           <a class="source" href="jquery.msAjax.html">                 jquery.msAjax.js               </a>                                           <a class="source" href="jquery.ns.html">                 jquery.ns.js               </a>                                           <a class="source" href="jquery.partialLoad.html">                 jquery.partialLoad.js               </a>                                           <a class="source" href="jquery.pointerEvents.html">                 jquery.pointerEvents.js               </a>                                           <a class="source" href="jquery.pointerGestures.html">                 jquery.pointerGestures.js               </a>                                           <a class="source" href="jquery.postMessage.html">                 jquery.postMessage.js               </a>                                           <a class="source" href="jquery.proxyAll.html">                 jquery.proxyAll.js               </a>                                           <a class="source" href="jquery.queryString.html">                 jquery.queryString.js               </a>                                           <a class="source" href="jquery.scrollAnchor.html">                 jquery.scrollAnchor.js               </a>                                           <a class="source" href="jquery.uncomment.html">                 jquery.uncomment.js               </a>                                           <a class="source" href="jquery.url.html">                 jquery.url.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs"><a href="../index.html">Home</a> | 
<a href="https://github.com/vistaprint/SkinnyJS/blob/master/js/jquery.menu.js" target="_blank">View this file on Github</a>

<hr style="height: 1px; border:0; background-color:#4A525A">
             <h1>               jquery.menu.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>/ <reference path="jquery.hoverDelay.js" />
/ <reference path="jquery.pointerEvents.js" />
/ <reference path="jquery.pointerGestures.js" />
TODO: Support modifying state in the future by storing an object using $.data(), implement $(selector).dropDownMenu("option", value);
TODO: Accessibility: Keyboard navigation (tab navigation already works)- close submenus on pressing enter (maybe)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">_skins</span> <span class="o">=</span> <span class="p">{};</span>

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Register skins by name for rendering the menu.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">$</span><span class="p">.</span><span class="nx">registerDropDownMenuSkin</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">skin</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">_skins</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">skin</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Hover highlighting</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">function</span> <span class="nx">highlightMenuItem</span><span class="p">(</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">enabled</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">classToAdd</span> <span class="o">=</span> <span class="nx">enabled</span> <span class="o">?</span> <span class="s2">&quot;hover&quot;</span> <span class="o">:</span> <span class="s2">&quot;nohover&quot;</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">classToRemove</span> <span class="o">=</span> <span class="nx">enabled</span> <span class="o">?</span> <span class="s2">&quot;nohover&quot;</span> <span class="o">:</span> <span class="s2">&quot;hover&quot;</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$item</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="nx">classToAdd</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">$item</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">classToAdd</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">classToRemove</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>TODO: It would be nice to have a jQuery.findUntil(selector)
This is a simple substitute. Recurse until the an element is found
with the specified class, and then stop searching in that node.</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">function</span> <span class="nx">findUntilInternal</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">fnIsMatch</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">fnIsMatch</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">findUntilInternal</span><span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">fnIsMatch</span><span class="p">,</span> <span class="nx">results</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>jQuery wrapper</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">function</span> <span class="nx">findUntil</span><span class="p">(</span><span class="nx">$elem</span><span class="p">,</span> <span class="nx">fnIsMatch</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="nx">$elem</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">findUntilInternal</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">fnIsMatch</span><span class="p">,</span> <span class="nx">results</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="nx">results</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">_defaults</span> <span class="o">=</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>When true, the top level menu opens on mouseover (instead of on click, which is the default).</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">showOnHover</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>

</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>When true, and showOnHover is enabled, clicking an A tag within a menu item that contains a submenu will be allowed to navigate
NOTE: This option is ignored when showOnHover is false.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">linksWithSubmenusEnabled</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Event which fires when a menu item is selected.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">selected</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Event which fires before a menu panel is show. Can be used to prevent the panel from showing.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">beforeShowPanel</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Event which fires before a menu panel is hidden. Can be used to prevent the panel from hiding.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">beforeHidePanel</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Event which fires after a panel is shown.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">showPanelComplete</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Event which fires after a panel is hidden.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">hidePanelComplete</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Event which fires on show allowing you to override the animation</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">animationShow</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Event which fires on hide allowing you to override the animation</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">animationHide</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Event which allows overriding the positioning of a panel when it is shown. 
This is defined by the skin by default, but can be overridden for any instance of the menu.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">position</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>The predefined skin to use for rendering this instance</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">skin</span><span class="o">:</span> <span class="s2">&quot;basic&quot;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Dropdown menu plugin. The jQuery element collection should include
top-level container elements which in turn contain items with class "menu-item".
Each item in the jQuery collection becomes a menu "group".</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">dropDownMenu</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Map skin from the registered skin collection</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="kd">var</span> <span class="nx">_skin</span> <span class="o">=</span> <span class="nx">_skins</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">skin</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_skin</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Invalid dropDownMenu skin: &quot;</span> <span class="o">+</span> <span class="nx">options</span><span class="p">.</span><span class="nx">skin</span><span class="p">);</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Merge explicit options with skin and defaults</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="kd">var</span> <span class="nx">_options</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">_defaults</span><span class="p">,</span> <span class="nx">_skin</span> <span class="o">||</span> <span class="p">{},</span> <span class="nx">options</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Resolve conflicting options</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_options</span><span class="p">.</span><span class="nx">showOnHover</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">_options</span><span class="p">.</span><span class="nx">linksWithSubmenusEnabled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Creates a menu "group" from a jQuery collection of top-level
menu items. This will be called once for each element in the
top level jQuery object's collection.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="kd">function</span> <span class="nx">createMenuFromTopMenuItems</span><span class="p">(</span><span class="nx">$topLevelItems</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Assign a CSS class to help distinguish between top-level
and sub menus.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">$topLevelItems</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;menu-item-top&quot;</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">_panels</span> <span class="o">=</span> <span class="p">[];</span>

</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>The menu panel heirarchy root element</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="kd">var</span> <span class="nx">_rootMenu</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">parent</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
                <span class="nx">children</span><span class="o">:</span> <span class="p">[]</span>
            <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>When a top menu button is clicked, the menu
begins to react to hover events (mimics Windows/MacOS menus).</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="kd">var</span> <span class="nx">_clickHoverActivated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Used to signal the document click handler that 
the click came from the menu, so it should be ignored.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="kd">var</span> <span class="nx">_ignoreDocumentClick</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

            <span class="kd">var</span> <span class="nx">Panel</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Panel</span><span class="p">(</span><span class="nx">$panel</span><span class="p">,</span> <span class="nx">$item</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">me</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">$panel</span> <span class="o">=</span> <span class="nx">$panel</span><span class="p">;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$item</span> <span class="o">=</span> <span class="nx">$item</span> <span class="o">||</span> <span class="nx">$panel</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.menu-item&quot;</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">$parentPanel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$item</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.menu-panel&quot;</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">isTopLevel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">$parentPanel</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="p">[];</span>

</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Indicates the Panel is open (expanded)</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">this</span><span class="p">.</span><span class="nx">isOpen</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Indicates that the panel is in the middle of showing/hiding</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">this</span><span class="p">.</span><span class="nx">transitioning</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Store a reference to this instance from the DOM element</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$panel</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">$panel</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;PanelInstance&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
                <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Bind event handlers to DOM elements</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Assign a special class to distinguish menu items with a submenu from those without one.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="nx">me</span><span class="p">.</span><span class="nx">$item</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;menu-item-with-submenu&quot;</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Bind the special "press" event, when an item is tapped we determine what to do.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="nx">me</span><span class="p">.</span><span class="nx">$item</span><span class="p">.</span><span class="nx">on</span><span class="p">({</span>
                        <span class="s2">&quot;press&quot;</span><span class="o">:</span> <span class="nx">toggleClick</span><span class="p">,</span>
                        <span class="s2">&quot;click&quot;</span><span class="o">:</span> <span class="nx">preventClickSometimes</span>
                    <span class="p">});</span>

</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>setup pointer hover events only when the option is enabled</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">_options</span><span class="p">.</span><span class="nx">showOnHover</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Set up event handlers to control submenus appearing on hover</p>             </td>             <td class="code">               <div class="highlight"><pre>
                        <span class="nx">me</span><span class="p">.</span><span class="nx">$item</span><span class="p">.</span><span class="nx">hoverDelay</span><span class="p">(</span><span class="nx">showOnPointerOver</span><span class="p">,</span> <span class="nx">hideOnPointerOut</span><span class="p">,</span> <span class="p">{</span>
                            <span class="nx">delayOver</span><span class="o">:</span> <span class="nx">me</span><span class="p">.</span><span class="nx">isTopLevel</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">_options</span><span class="p">.</span><span class="nx">showOnHover</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
                            <span class="nx">delayOut</span><span class="o">:</span> <span class="mi">500</span>
                        <span class="p">});</span>
                    <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Top menu items have different rules for rollovers (mimics Windows/MacOS menus)</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">isTopLevel</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">me</span><span class="p">.</span><span class="nx">$item</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;pointerout&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">me</span><span class="p">.</span><span class="nx">isOpen</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Prevent mouseouts when rolling over tags within the same menu item.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                                <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">relatedTarget</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">has</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">relatedTarget</span><span class="p">).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">is</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">relatedTarget</span><span class="p">))</span> <span class="p">{</span>
                                        <span class="k">return</span><span class="p">;</span>
                                    <span class="p">}</span>
                                <span class="p">}</span>

                                <span class="nx">highlight</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">});</span>
                    <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Note: It is legitimate to have a Panel object without a submenu.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">$panel</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Event handler for clicking on panels.
Handles firing the "selected" event.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                        <span class="nx">me</span><span class="p">.</span><span class="nx">$panel</span><span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Find the parent menu item of the clicked element.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                            <span class="kd">var</span> <span class="nx">$clickedMenuItem</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.menu-item&quot;</span><span class="p">,</span> <span class="nx">me</span><span class="p">.</span><span class="nx">$panel</span><span class="p">);</span>

                            <span class="k">if</span> <span class="p">(</span><span class="nx">$clickedMenuItem</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>If the menu item has a submenu, then it shouldn't
fire selected- it just opens the submenu.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">$clickedMenuItem</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;menu-item-with-submenu&quot;</span><span class="p">))</span> <span class="p">{</span>
                                    <span class="kd">var</span> <span class="nx">ev</span> <span class="o">=</span> <span class="nx">getEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                                    <span class="nx">ev</span><span class="p">.</span><span class="nx">$selectedItem</span> <span class="o">=</span> <span class="nx">$clickedMenuItem</span><span class="p">;</span>
                                    <span class="nx">ev</span><span class="p">.</span><span class="nx">selectedItem</span> <span class="o">=</span> <span class="nx">$clickedMenuItem</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

                                    <span class="k">if</span> <span class="p">(</span><span class="nx">_options</span><span class="p">.</span><span class="nx">selected</span><span class="p">)</span> <span class="p">{</span>
                                        <span class="nx">_options</span><span class="p">.</span><span class="nx">selected</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">ev</span><span class="p">);</span>
                                    <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Give the event handler a chance to cancel the event.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                                    <span class="k">if</span> <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">cancel</span><span class="p">)</span> <span class="p">{</span>
                                        <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
                                        <span class="k">return</span><span class="p">;</span>
                                    <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>If this is a click on a leaf node, and the window is navigating, don't hide the menu.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">e</span><span class="p">.</span><span class="nx">isDefaultPrevented</span><span class="p">())</span> <span class="p">{</span>
                                        <span class="k">return</span><span class="p">;</span>
                                    <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>The clicked element was a menu item with no sub-menu: hide.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                                    <span class="nx">hideAllClick</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                                <span class="p">}</span>
                            <span class="p">}</span>

                            <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
                        <span class="p">});</span>

</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Ensure a tags within a menu item with a submenu get disabled
This flag setting allows the menu to make sub menu items
only open/close the submenu, and prevent navigation with clicks
Note: That on touch events, these sub menu links always cause
the sub menu to toggle.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_options</span><span class="p">.</span><span class="nx">linksWithSubmenusEnabled</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">getLinksWithSubmenus</span><span class="p">().</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>prevent the navigation behavior</p>             </td>             <td class="code">               <div class="highlight"><pre>
                                <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>stop propagation to prevent this click from going to
document and elements beneath this menu item</p>             </td>             <td class="code">               <div class="highlight"><pre>
                                <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
                            <span class="p">});</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="kd">function</span> <span class="nx">getLinksWithSubmenus</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">findUntil</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">$item</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Stop searching once we get to the nested panel.
We're only interested in A tags owned by this specific
menu item.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">elem</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;menu-panel&quot;</span><span class="p">))</span> <span class="p">{</span>
                            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Add links found to the results</p>             </td>             <td class="code">               <div class="highlight"><pre>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">tagName</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">elem</span><span class="p">);</span>
                        <span class="p">}</span>

                        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="p">});</span>
                <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Resolves the .parent property and adds this Panel
to the parent's children property.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">this</span><span class="p">.</span><span class="nx">resolveParent</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">resolveParent</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">me</span><span class="p">.</span><span class="nx">parent</span> <span class="o">=</span> <span class="nx">me</span><span class="p">.</span><span class="nx">$parentPanel</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s2">&quot;PanelInstance&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">_rootMenu</span><span class="p">;</span>
                    <span class="nx">me</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">me</span><span class="p">);</span>
                <span class="p">};</span>

                <span class="kd">var</span> <span class="nx">_level</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Gets the level of the Panel in the heirarchy. 0 is the root menu item.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">this</span><span class="p">.</span><span class="nx">getLevel</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">getLevel</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">_level</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_level</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="c1">// Account for _rootMenu: first level menu should be level 0</span>
                        <span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">me</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
                        <span class="k">while</span> <span class="p">(</span><span class="nx">current</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">current</span> <span class="o">=</span> <span class="nx">current</span><span class="p">.</span><span class="nx">parent</span><span class="p">;</span>
                            <span class="nx">_level</span><span class="o">++</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="k">return</span> <span class="nx">_level</span><span class="p">;</span>
                <span class="p">};</span>

                <span class="kd">var</span> <span class="nx">_siblings</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Gets an array of the siblings of this Panel (Panels with the same parent)</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">this</span><span class="p">.</span><span class="nx">getSiblings</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">getSiblings</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_siblings</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_siblings</span> <span class="o">=</span> <span class="p">[];</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                                <span class="k">if</span> <span class="p">(</span><span class="k">this</span> <span class="o">!==</span> <span class="nx">me</span><span class="p">)</span> <span class="p">{</span>
                                    <span class="nx">_siblings</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
                                <span class="p">}</span>
                            <span class="p">});</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="k">return</span> <span class="nx">_siblings</span><span class="p">;</span>
                <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>TODO use a jQuery event
Creates a new "fake" event for passing to event handlers</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="kd">function</span> <span class="nx">getEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="p">{</span>
                        <span class="nx">$panel</span><span class="o">:</span> <span class="nx">me</span><span class="p">.</span><span class="nx">$panel</span><span class="p">,</span>
                        <span class="nx">panel</span><span class="o">:</span> <span class="nx">me</span><span class="p">,</span>
                        <span class="nx">$parentPanel</span><span class="o">:</span> <span class="nx">me</span><span class="p">.</span><span class="nx">$parentPanel</span><span class="p">,</span>
                        <span class="nx">parentPanel</span><span class="o">:</span> <span class="nx">me</span><span class="p">.</span><span class="nx">$parentPanel</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="nx">$item</span><span class="o">:</span> <span class="nx">me</span><span class="p">.</span><span class="nx">$item</span><span class="p">,</span>
                        <span class="nx">item</span><span class="o">:</span> <span class="nx">me</span><span class="p">.</span><span class="nx">$item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="nx">level</span><span class="o">:</span> <span class="nx">me</span><span class="p">.</span><span class="nx">getLevel</span><span class="p">(),</span>
                        <span class="nx">innerEvent</span><span class="o">:</span> <span class="nx">e</span><span class="p">,</span>
                        <span class="nx">preventDefault</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                            <span class="k">this</span><span class="p">.</span><span class="nx">cancel</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">};</span>
                <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Adds/removes the "hover" class. Allows callers to 
define their own rollover states.
Note: We cant use CSS hover pseudo-classes because the rules
for Windows/MacOS style menus don't follow the same rules.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="kd">function</span> <span class="nx">highlight</span><span class="p">(</span><span class="nx">enabled</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">highlightMenuItem</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">$item</span><span class="p">,</span> <span class="nx">enabled</span><span class="p">);</span>
                <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Determines if the current menu should show on hover (in addition to click)</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="kd">function</span> <span class="nx">shouldShowSubmenuOnHover</span><span class="p">()</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">me</span><span class="p">.</span><span class="nx">isTopLevel</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>If this is the top menu, only react to a mouseover event
if we're in "hover mode" (there has already been a click),
or if we're in the "always on" hover mode.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="k">return</span> <span class="nx">_clickHoverActivated</span> <span class="o">||</span> <span class="nx">_options</span><span class="p">.</span><span class="nx">showOnHover</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="kd">function</span> <span class="nx">showOnPointerOver</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>In Windows/MacOS, top level menus highlight instantly, with no delay</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">isTopLevel</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">highlight</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">shouldShowSubmenuOnHover</span><span class="p">())</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="nx">me</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="kd">function</span> <span class="nx">hideOnPointerOut</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">isTopLevel</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">_options</span><span class="p">.</span><span class="nx">showOnHover</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">shouldShowSubmenuOnHover</span><span class="p">())</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="nx">me</span><span class="p">.</span><span class="nx">hide</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Shows the panel</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">this</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">show</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">transitioning</span> <span class="o">||</span> <span class="nx">me</span><span class="p">.</span><span class="nx">isOpen</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="kd">var</span> <span class="nx">ev</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">$panel</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">ev</span> <span class="o">=</span> <span class="nx">getEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>

                        <span class="k">if</span> <span class="p">(</span><span class="nx">_options</span><span class="p">.</span><span class="nx">beforeShowPanel</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">_options</span><span class="p">.</span><span class="nx">beforeShowPanel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">me</span><span class="p">,</span> <span class="nx">ev</span><span class="p">);</span>
                        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Give the handler a chance to cancel the event</p>             </td>             <td class="code">               <div class="highlight"><pre>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">cancel</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">return</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Ensure that all siblings are hidden</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">getSiblings</span><span class="p">(),</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                    <span class="p">});</span>

                    <span class="nx">hideOtherMenus</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Ensure the current menu item is highlighted</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="nx">highlight</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">me</span><span class="p">.</span><span class="nx">$panel</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="nx">me</span><span class="p">.</span><span class="nx">transitioning</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Hook for positioning strategies</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="nx">ev</span> <span class="o">=</span> <span class="nx">getEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Fire the position event provided by the skin or options
to calculate positioning for the menu</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">_options</span><span class="p">.</span><span class="nx">position</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_options</span><span class="p">.</span><span class="nx">position</span><span class="p">(</span><span class="nx">ev</span><span class="p">);</span>
                    <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>if we have a hook to override the animation we use</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">_options</span><span class="p">.</span><span class="nx">animationShow</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_options</span><span class="p">.</span><span class="nx">animationShow</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">me</span><span class="p">,</span> <span class="nx">ev</span><span class="p">,</span> <span class="nx">showComplete</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">$panel</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
                        <span class="nx">showComplete</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">};</span>

                <span class="kd">function</span> <span class="nx">showComplete</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">me</span><span class="p">.</span><span class="nx">isOpen</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="nx">me</span><span class="p">.</span><span class="nx">transitioning</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">_options</span><span class="p">.</span><span class="nx">showPanelComplete</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_options</span><span class="p">.</span><span class="nx">showPanelComplete</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">me</span><span class="p">,</span> <span class="nx">getEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">));</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">hide</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">hide</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">me</span><span class="p">.</span><span class="nx">isOpen</span> <span class="o">||</span> <span class="nx">me</span><span class="p">.</span><span class="nx">transitioning</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">$panel</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">ev</span> <span class="o">=</span> <span class="nx">getEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>

                        <span class="k">if</span> <span class="p">(</span><span class="nx">_options</span><span class="p">.</span><span class="nx">beforeHidePanel</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">_options</span><span class="p">.</span><span class="nx">beforeHidePanel</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">me</span><span class="p">,</span> <span class="nx">ev</span><span class="p">);</span>
                        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>Give the handler a chance to cancel the event</p>             </td>             <td class="code">               <div class="highlight"><pre>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">ev</span><span class="p">.</span><span class="nx">cancel</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">return</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="nx">highlight</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">me</span><span class="p">.</span><span class="nx">$panel</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="nx">me</span><span class="p">.</span><span class="nx">transitioning</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

                    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                    <span class="p">});</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">_options</span><span class="p">.</span><span class="nx">animationHide</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_options</span><span class="p">.</span><span class="nx">animationHide</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">me</span><span class="p">,</span> <span class="nx">getEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">),</span> <span class="nx">hideComplete</span><span class="p">);</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">$panel</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
                        <span class="nx">hideComplete</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">};</span>

                <span class="kd">function</span> <span class="nx">hideComplete</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">me</span><span class="p">.</span><span class="nx">isOpen</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="nx">me</span><span class="p">.</span><span class="nx">transitioning</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">_options</span><span class="p">.</span><span class="nx">hidePanelComplete</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_options</span><span class="p">.</span><span class="nx">hidePanelComplete</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">me</span><span class="p">,</span> <span class="nx">getEvent</span><span class="p">(</span><span class="nx">e</span><span class="p">));</span>
                    <span class="p">}</span>
                <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>signal to prevent the next click, set during a touch event
to prevent the click, because you cannot cancel the
native "click" event reliably outside of the "click" event
itself</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="kd">var</span> <span class="nx">_shouldPreventNextClick</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Sometimes, we need to prevent the native click event
it's sad, but this is the best implementation I've created</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="kd">function</span> <span class="nx">preventClickSometimes</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>we stop propagation to prevent this click from
going to the document handler to close all menus
this also prevents the clicks from going through
to items below the menu</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">_shouldPreventNextClick</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>compare the time difference, we only listen to this
prevention if it's within 200ms of the original
event to prevent errors</p>             </td>             <td class="code">               <div class="highlight"><pre>
                        <span class="kd">var</span> <span class="nx">timeDiff</span> <span class="o">=</span> <span class="o">+</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">())</span> <span class="o">-</span> <span class="nx">_shouldPreventNextClick</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>reset the trigger</p>             </td>             <td class="code">               <div class="highlight"><pre>
                        <span class="nx">_shouldPreventNextClick</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>if the time difference is less than 1000ms (1s)</p>             </td>             <td class="code">               <div class="highlight"><pre>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">timeDiff</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>prevent default to prevent navigation (possibly)</p>             </td>             <td class="code">               <div class="highlight"><pre>
                            <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="kd">function</span> <span class="nx">toggleClick</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>we always want to stop the propagation to parent elements,
this can cause the inner leaf items to close sub menus,
or close the menus if it reaches the root document or
just cause double-trigger if the target was the <a> when the
handler is on the <li></p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="nx">e</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>

</pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>if this is a mouse click, we do not want to interrupt normal navigation
if there is no panel it should act like a regular link, always.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">me</span><span class="p">.</span><span class="nx">$panel</span> <span class="o">||</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pointerType</span> <span class="o">==</span> <span class="s2">&quot;mouse&quot;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>determine if this event has bubbled</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">$panel</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">$closestPanel</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s2">&quot;.menu-panel&quot;</span><span class="p">);</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">$closestPanel</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">$closestPanel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nx">me</span><span class="p">.</span><span class="nx">$panel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
                            <span class="nx">_shouldPreventNextClick</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>This event bubbled from a child panel's link (a leaf menu item).
It doesn't have a Panel object of its own, so it should act like a regular link.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                            <span class="k">return</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>For touch events that aren't from leaf menu items,
cancel the default event so touching the menu doesn't cause navigation.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="nx">_shouldPreventNextClick</span> <span class="o">=</span> <span class="o">+</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
                    <span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">transitioning</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="nx">me</span><span class="p">[</span><span class="nx">me</span><span class="p">.</span><span class="nx">isOpen</span> <span class="o">?</span> <span class="s2">&quot;hideClick&quot;</span> <span class="o">:</span> <span class="s2">&quot;showClick&quot;</span><span class="p">](</span><span class="nx">e</span><span class="p">);</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">isTopLevel</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_ignoreDocumentClick</span> <span class="o">=</span> <span class="o">+</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">showClick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">isTopLevel</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_clickHoverActivated</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="nx">me</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                <span class="p">};</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">hideClick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">me</span><span class="p">.</span><span class="nx">isTopLevel</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_clickHoverActivated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="nx">me</span><span class="p">.</span><span class="nx">hide</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                <span class="p">};</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">hideForce</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">_clickHoverActivated</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="nx">me</span><span class="p">.</span><span class="nx">hide</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                <span class="p">};</span>

                <span class="nx">init</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Hides all menus and submenus</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="kd">function</span> <span class="nx">hideAllClick</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">_ignoreDocumentClick</span> <span class="o">=</span> <span class="o">+</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>

                <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">_rootMenu</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">hideForce</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Handler for a document click to close all menus</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="kd">function</span> <span class="nx">documentClickHandler</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Check a flag which indicates the click is from the menu itself</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">if</span> <span class="p">(</span><span class="nx">_ignoreDocumentClick</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>store the time difference, we only listen to this
prevention if it's within 200ms of the original
event to prevent errors</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="kd">var</span> <span class="nx">timeDiff</span> <span class="o">=</span> <span class="o">+</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">())</span> <span class="o">-</span> <span class="nx">_ignoreDocumentClick</span><span class="p">;</span>

                    <span class="nx">_ignoreDocumentClick</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

                    <span class="k">if</span> <span class="p">(</span><span class="nx">timeDiff</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="nx">hideAllClick</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">_allCloseHandlers</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">hideAllClick</span><span class="p">);</span>

            <span class="kd">function</span> <span class="nx">hideOtherMenus</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">_allCloseHandlers</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">_allCloseHandlers</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">hideAllClick</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">_allCloseHandlers</span><span class="p">[</span><span class="nx">i</span><span class="p">](</span><span class="nx">e</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Create a Panel instance for each menu panel, store in an array</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">$topLevelItems</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.menu-panel&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">_panels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">Panel</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">)));</span>
            <span class="p">});</span>

</pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Top level items without a submenu need a Panel instance as well, to interact with other top level items.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">$topLevelItems</span><span class="p">.</span><span class="nx">not</span><span class="p">(</span><span class="s2">&quot;.menu-item-with-submenu&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">_panels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">new</span> <span class="nx">Panel</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">)));</span>
            <span class="p">});</span>

</pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Build a tree representing the parent/child relationships in the menu</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">_panels</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">resolveParent</span><span class="p">();</span>
            <span class="p">});</span>

</pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>Set up rollovers on the menu items.
Note: This does not include the top level items with submenus, which have different
rules for rollovers. jQuery.find() only includes decendants, no the current set,
which is the top level menu items.</p>

<p>we use hoverDelay because it internally filters out touch-based pointer events</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">$topLevelItems</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s2">&quot;.menu-item&quot;</span><span class="p">).</span><span class="nx">hoverDelay</span><span class="p">(</span>
                <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="nx">highlightMenuItem</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
                <span class="p">},</span>
                <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="nx">highlightMenuItem</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="kc">false</span><span class="p">);</span>
                <span class="p">})</span>
                <span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="nx">highlightMenuItem</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="kc">false</span><span class="p">);</span>
                <span class="p">});</span>

</pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Bind a handler to close the menu if it is clicked off.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="nx">documentClickHandler</span><span class="p">);</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Loop through each menu container and create a menu "group".</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Find all the top-level menu items within the container.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="kd">var</span> <span class="nx">$topLevelItems</span> <span class="o">=</span> <span class="nx">findUntil</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">),</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">elem</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s2">&quot;menu-item&quot;</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">elem</span><span class="p">);</span>
                    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">});</span>

</pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Invoke the create menu function with a jQuery object
containing all the top level menu items.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">createMenuFromTopMenuItems</span><span class="p">(</span><span class="nx">$topLevelItems</span><span class="p">);</span>
        <span class="p">});</span>

</pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Allow the jQuery chain to remain unbroken.</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">_allCloseHandlers</span> <span class="o">=</span> <span class="p">[];</span>

<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 