<!DOCTYPE html>  <html> <head>   <title>jquery.calcRestrainedPos.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="breakpoints.html">                 breakpoints.js               </a>                                           <a class="source" href="date-parse.html">                 date-parse.js               </a>                                           <a class="source" href="jquery.breakpoints.html">                 jquery.breakpoints.js               </a>                                           <a class="source" href="jquery.calcRestrainedPos.html">                 jquery.calcRestrainedPos.js               </a>                                           <a class="source" href="jquery.clientRect.html">                 jquery.clientRect.js               </a>                                           <a class="source" href="jquery.contentSize.html">                 jquery.contentSize.js               </a>                                           <a class="source" href="jquery.cookies.html">                 jquery.cookies.js               </a>                                           <a class="source" href="jquery.css.html">                 jquery.css.js               </a>                                           <a class="source" href="jquery.customEvent.html">                 jquery.customEvent.js               </a>                                           <a class="source" href="jquery.delimitedString.html">                 jquery.delimitedString.js               </a>                                           <a class="source" href="jquery.disableEvent.html">                 jquery.disableEvent.js               </a>                                           <a class="source" href="jquery.hostIframe.html">                 jquery.hostIframe.js               </a>                                           <a class="source" href="jquery.hoverDelay.html">                 jquery.hoverDelay.js               </a>                                           <a class="source" href="jquery.htmlEncode.html">                 jquery.htmlEncode.js               </a>                                           <a class="source" href="jquery.imageSize.html">                 jquery.imageSize.js               </a>                                           <a class="source" href="jquery.isVisibleKeyCode.html">                 jquery.isVisibleKeyCode.js               </a>                                           <a class="source" href="jquery.menu.html">                 jquery.menu.js               </a>                                           <a class="source" href="jquery-menu-exampleskin.html">                 jquery-menu-exampleskin.js               </a>                                           <a class="source" href="jquery.modalDialog.deviceFixes.html">                 jquery.modalDialog.deviceFixes.js               </a>                                           <a class="source" href="jquery.modalDialog.getSettings.html">                 jquery.modalDialog.getSettings.js               </a>                                           <a class="source" href="jquery.modalDialog.header.html">                 jquery.modalDialog.header.js               </a>                                           <a class="source" href="jquery.modalDialog.history.html">                 jquery.modalDialog.history.js               </a>                                           <a class="source" href="jquery.modalDialog.html">                 jquery.modalDialog.js               </a>                                           <a class="source" href="jquery.modalDialog.unobtrusive.html">                 jquery.modalDialog.unobtrusive.js               </a>                                           <a class="source" href="jquery.modalDialog.userAgent.html">                 jquery.modalDialog.userAgent.js               </a>                                           <a class="source" href="jquery.modalDialogContent.header.html">                 jquery.modalDialogContent.header.js               </a>                                           <a class="source" href="jquery.modalDialogContent.html">                 jquery.modalDialogContent.js               </a>                                           <a class="source" href="jquery.msAjax.html">                 jquery.msAjax.js               </a>                                           <a class="source" href="jquery.ns.html">                 jquery.ns.js               </a>                                           <a class="source" href="jquery.partialLoad.html">                 jquery.partialLoad.js               </a>                                           <a class="source" href="jquery.postMessage.html">                 jquery.postMessage.js               </a>                                           <a class="source" href="jquery.proxyAll.html">                 jquery.proxyAll.js               </a>                                           <a class="source" href="jquery.queryString.html">                 jquery.queryString.js               </a>                                           <a class="source" href="jquery.richTooltip.html">                 jquery.richTooltip.js               </a>                                           <a class="source" href="jquery.scrollAnchor.html">                 jquery.scrollAnchor.js               </a>                                           <a class="source" href="jquery.uncomment.html">                 jquery.uncomment.js               </a>                                           <a class="source" href="jquery.url.html">                 jquery.url.js               </a>                                           <a class="source" href="pointy.gestures.html">                 pointy.gestures.js               </a>                                           <a class="source" href="pointy.html">                 pointy.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs"><a href="../index.html">Home</a> | 
<a href="https://github.com/vistaprint/SkinnyJS/blob/master/js/jquery.calcRestrainedPos.js" target="_blank">View this file on Github</a>

<hr style="height: 1px; border:0; background-color:#4A525A">
             <h1>               jquery.calcRestrainedPos.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>/ <reference path="jquery.clientRect.js" /></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">apply</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">container</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">direction</span><span class="o">:</span> <span class="s1">&#39;north&#39;</span><span class="p">,</span>
        <span class="nx">offsets</span><span class="o">:</span> <span class="p">{},</span>
        <span class="nx">viewport</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">nextDirection</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;north&#39;</span><span class="o">:</span> <span class="s1">&#39;east&#39;</span><span class="p">,</span>
        <span class="s1">&#39;east&#39;</span><span class="o">:</span> <span class="s1">&#39;south&#39;</span><span class="p">,</span>
        <span class="s1">&#39;south&#39;</span><span class="o">:</span> <span class="s1">&#39;west&#39;</span><span class="p">,</span>
        <span class="s1">&#39;west&#39;</span><span class="o">:</span> <span class="s1">&#39;north&#39;</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>calculate a position restrained within a container and the viewport</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">.</span><span class="nx">calcRestrainedPos</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>merge options</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">options</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">defaults</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>if the element has different sizes for different positions, then specify them as a <direction,size> hash</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">contentSizes</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">contentSizes</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>the element you are calculating the position for is the content</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">bounds</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">content</span><span class="p">).</span><span class="nx">clientRect</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>if you provide us a context (position relative to this element)</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">contextBounds</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">context</span><span class="p">).</span><span class="nx">clientRect</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>if a container is provided we must keep the position restrained within</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">containerBounds</span> <span class="o">||</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">container</span> <span class="o">?</span> <span class="nx">$</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">container</span><span class="p">).</span><span class="nx">clientRect</span><span class="p">()</span> <span class="o">:</span> <span class="kc">null</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>areas of the screen that are off-limits to the content</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">obstacles</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">exclusions</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>get the size of the viewport</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">viewport</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">viewportBounds</span> <span class="o">||</span> <span class="p">{</span>
            <span class="nx">width</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientWidth</span><span class="p">,</span>
            <span class="nx">height</span><span class="o">:</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientHeight</span>
        <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>allow offsets to be passed</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">offsets</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
            <span class="nx">padding</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>applies spacing to keep content X pixels away from bounds of viewport</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">viewport</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>applies spacing to keep content X pixels away from bounds of container</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">container</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>applies spacing to keep content X pixels away from bounds of context</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="nx">vertical</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="nx">horizontal</span><span class="o">:</span> <span class="mi">0</span>
        <span class="p">},</span> <span class="nx">options</span><span class="p">.</span><span class="nx">offsets</span> <span class="o">||</span> <span class="p">{});</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>pos we return at the end, we add to this object</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">reset</span> <span class="o">||</span> <span class="p">{};</span>

        <span class="kd">function</span> <span class="nx">getContentSize</span><span class="p">(</span><span class="nx">direction</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">bounds</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">contentSizes</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">bounds</span> <span class="o">=</span> <span class="nx">contentSizes</span><span class="p">[</span><span class="nx">direction</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">bounds</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">bounds</span> <span class="o">=</span> <span class="nx">content</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">bounds</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">attemptDirection</span><span class="p">(</span><span class="nx">direction</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="nx">direction</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;north&#39;</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>first attempt to position content directly centered above the context</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">vertical</span><span class="p">;</span>
                <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isCornerAdjacent</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">pos</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="s1">&#39;east&#39;</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>first attempt to position content directly centered right of the context</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
                <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">horizontal</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isCornerAdjacent</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">pos</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="s1">&#39;south&#39;</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>first attempt to position content directly centered below the context</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">height</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">vertical</span><span class="p">;</span>
                <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">,</span> <span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">));</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isCornerAdjacent</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">pos</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="s1">&#39;west&#39;</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>first attempt to position content directly centered right of context</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
                <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">horizontal</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isCornerAdjacent</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">pos</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>compensate for a container, if we must</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">function</span> <span class="nx">compensateContainer</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">posLimits</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">container</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>compensate for container, appearing outside to north of container</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">&lt;</span> <span class="nx">container</span><span class="p">.</span><span class="nx">top</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">container</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;east&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;west&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isCornerAdjacent</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">pos</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">;</span>
                        <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minY</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>compensate for container, appearing outside to south of container</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span> <span class="o">&gt;</span> <span class="nx">container</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">container</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">container</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">container</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;east&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;west&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isCornerAdjacent</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">pos</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">)</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
                        <span class="nx">posLimits</span><span class="p">.</span><span class="nx">maxY</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>compensate for container, appearing outside to east of container</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;</span> <span class="nx">container</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">container</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">container</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">container</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;north&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;south&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isCornerAdjacent</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">pos</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">)</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
                        <span class="nx">posLimits</span><span class="p">.</span><span class="nx">maxX</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>compensate for container, appearing outside to west of container</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">&lt;</span> <span class="nx">container</span><span class="p">.</span><span class="nx">left</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">container</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;north&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;south&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isCornerAdjacent</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">pos</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">;</span>
                        <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minX</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>compensate for the viewport, if we haven't opted out</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">function</span> <span class="nx">compensateViewport</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">posLimits</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">viewport</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>north check</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">&lt;</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">viewport</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">viewport</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;east&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;west&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isCornerAdjacent</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">pos</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">;</span>
                        <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minY</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>south check</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span> <span class="o">&gt;</span> <span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">viewport</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;east&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;west&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isCornerAdjacent</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">pos</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">)</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
                        <span class="nx">posLimits</span><span class="p">.</span><span class="nx">maxY</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>east check</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;</span> <span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">viewport</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;north&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;south&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isCornerAdjacent</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">pos</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">)</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
                        <span class="nx">posLimits</span><span class="p">.</span><span class="nx">maxX</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>west check</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">&lt;</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">viewport</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">viewport</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;north&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;south&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isCornerAdjacent</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">pos</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Need to keep the corners adjancent, so adjust the position and update the posLimits.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">;</span>
                        <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minX</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>compensate for exclusions</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="cm">/*function compensateObstacles(direction, posLimits) {</span>
<span class="cm">            if (obstacles) {</span>
<span class="cm">                var box = $.extend({}, content, pos);</span>
<span class="cm">                var rect;</span>
<span class="cm">                var intersections = []; //track intersections encountered to prevent an infinite loop where bounce between two positions</span>
<span class="cm">                for (var i = 0; i &lt; obstacles.length; i++) {</span>
<span class="cm">                    rect = obstacles[i];</span>
<span class="cm">                    if ($.doBoundingBoxesIntersect(box, rect)) {</span>

<span class="cm">//DIVIDER</span>

<span class="cm">                        if (intersections[i]) {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                            box.left = posLimits.maxX + 1;</span>
<span class="cm">                            box.top = posLimits.maxY + 1;</span>
<span class="cm">                            break;</span>
<span class="cm">                        }</span>
<span class="cm">                        intersections[i] = true;</span>

<span class="cm">                        var newPos = {</span>
<span class="cm">                            top: box.top,</span>
<span class="cm">                            left: box.left</span>
<span class="cm">                        };</span>
<span class="cm">                        switch (direction) {</span>
<span class="cm">                        case &#39;north&#39;:</span>
<span class="cm">                        case &#39;south&#39;:</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                             </span>
<span class="cm">                            if ((box.left &lt; rect.left) &amp;&amp; (box.left + box.width &gt; rect.left)) {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                newPos.left = rect.left - (box.width + offsets.horizontal);</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                if (options.cornerAdjacent &amp;&amp; (newPos.left &lt; context.left + offsets.padding) &amp;&amp; (newPos.left + content.width &gt; context.left + context.width - offsets.padding)) {</span>
<span class="cm">                                    newPos.left = (context.left + context.width) - (content.width + offsets.padding);</span>
<span class="cm">                                }</span>
<span class="cm">                                if (newPos.left &lt; posLimits.minX) {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                    newPos.left = (rect.left + rect.width) + offsets.horizontal;</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                    if (options.cornerAdjacent &amp;&amp; (newPos.left &lt; context.left + offsets.padding) &amp;&amp; (newPos.left + content.width &gt; context.left + context.width - offsets.padding)) {</span>
<span class="cm">                                        newPos.left = context.left + offsets.padding;</span>
<span class="cm">                                    }</span>
<span class="cm">                                    if (newPos.left &gt; posLimits.maxX) {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                        i = obstacles.length;</span>
<span class="cm">                                    } else {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                        posLimits.minX = newPos.left;</span>
<span class="cm">                                    }</span>
<span class="cm">                                } else {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                    posLimits.maxX = newPos.left;</span>
<span class="cm">                                }</span>
<span class="cm">                            }</span>


<span class="cm">//DIVIDER</span>

<span class="cm">                            else { // if ((box.left &lt; rect.left + rect.width) &amp;&amp; (box.left + box.width &gt; rect.left + rect.width)) {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                newPos.left = (rect.left + rect.width) + offsets.horizontal;</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                if (options.cornerAdjacent &amp;&amp; (newPos.left &lt; context.left + offsets.padding) &amp;&amp; (newPos.left + content.width &gt; context.left + context.width - offsets.padding)) {</span>
<span class="cm">                                    newPos.left = context.left + offsets.padding;</span>
<span class="cm">                                }</span>
<span class="cm">                                if (newPos.left &gt; posLimits.maxX) {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                    newPos.left = rect.left - (box.width + offsets.horizontal);</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                    if (options.cornerAdjacent &amp;&amp; (newPos.left &lt; context.left + offsets.padding) &amp;&amp; (newPos.left + content.width &gt; context.left + context.width - offsets.padding)) {</span>
<span class="cm">                                        newPos.left = (context.left + context.width) - (content.width + offsets.padding);</span>
<span class="cm">                                    }</span>
<span class="cm">                                    if (newPos.left &lt; posLimits.minX) {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                        i = obstacles.length;</span>
<span class="cm">                                    } else {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                        posLimits.maxX = newPos.left;</span>
<span class="cm">                                    }</span>
<span class="cm">                                } else {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                    posLimits.minX = newPos.left;</span>
<span class="cm">                                }</span>
<span class="cm">                            }</span>
<span class="cm">                            box.left = newPos.left;</span>
<span class="cm">                            box.right = box.left + box.width;</span>
<span class="cm">                            break;</span>

<span class="cm">                        case &#39;west&#39;:</span>
<span class="cm">                        case &#39;east&#39;:</span>


<span class="cm">//DIVIDER</span>

<span class="cm">                            if ((box.top &lt; rect.top) &amp;&amp; (box.top + box.height &gt;= rect.top)) {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                newPos.top = rect.top - (box.height + offsets.vertical);</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                if (options.cornerAdjacent &amp;&amp; (newPos.top &lt; context.top + offsets.padding) &amp;&amp; (newPos.top + content.height &gt; context.top + context.height - offsets.padding)) {</span>
<span class="cm">                                    newPos.top = (context.top + context.height) - (content.height + offsets.padding);</span>
<span class="cm">                                }</span>
<span class="cm">                                if (newPos.top &lt; posLimits.minY) {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                    newPos.top = (rect.top + rect.height) + offsets.vertical;</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                    if (options.cornerAdjacent &amp;&amp; (newPos.top &lt; context.top + offsets.padding) &amp;&amp; (newPos.top + content.height &gt; context.top + context.height - offsets.padding)) {</span>
<span class="cm">                                        newPos.top = context.top + offsets.padding;</span>
<span class="cm">                                    }</span>
<span class="cm">                                    if (newPos.top &gt; posLimits.maxY) {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                        i = obstacles.length;</span>
<span class="cm">                                    } else {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                        posLimits.minY = newPos.top;</span>
<span class="cm">                                    }</span>
<span class="cm">                                } else {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                    posLimits.maxY = newPos.top;</span>
<span class="cm">                                }</span>
<span class="cm">                            }</span>


<span class="cm">//DIVIDER</span>

<span class="cm">                            else { // if ((box.top &gt; rect.top) &amp;&amp; (box.top + box.height &gt; rect.top)) {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                newPos.top = (rect.top + rect.height) + offsets.vertical;</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                if (options.cornerAdjacent &amp;&amp; (newPos.top &lt; context.top + offsets.padding) &amp;&amp; (newPos.top + content.height &gt; context.top + context.height - offsets.padding)) {</span>
<span class="cm">                                    newPos.top = context.top + offsets.padding;</span>
<span class="cm">                                }</span>
<span class="cm">                                if (newPos.top &gt; posLimits.maxY) {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                    newPos.top = rect.top - (box.height + offsets.vertical);</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                    if (options.cornerAdjacent &amp;&amp; (newPos.top &lt; context.top + offsets.padding) &amp;&amp; (newPos.top + content.height &gt; context.top + context.height - offsets.padding)) {</span>
<span class="cm">                                        newPos.top = (context.top + context.height) - (content.height + offsets.padding);</span>
<span class="cm">                                    }</span>
<span class="cm">                                    if (newPos.top &lt; posLimits.minY) {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                        i = obstacles.length;</span>
<span class="cm">                                    } else {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                        posLimits.maxY = newPos.top;</span>
<span class="cm">                                    }</span>
<span class="cm">                                } else {</span>

<span class="cm">//DIVIDER</span>
<span class="cm">                                    posLimits.minY = newPos.top;</span>
<span class="cm">                                }</span>
<span class="cm">                            }</span>
<span class="cm">                            box.top = newPos.top;</span>
<span class="cm">                            box.bottom = box.top + box.height;</span>
<span class="cm">                            break;</span>
<span class="cm">                        } //end switch (direction)</span>
<span class="cm">                        if ((i &gt; 0) &amp;&amp; (i &lt; obstacles.length)) {</span>
<span class="cm">                            i = -1; //restart loop</span>
<span class="cm">                        }</span>
<span class="cm">                    } //end if intersection found</span>
<span class="cm">                } //end for loop</span>
<span class="cm">                pos.left = box.left;</span>
<span class="cm">                pos.top = box.top;</span>
<span class="cm">            } //end if obstacles</span>
<span class="cm">        }*/</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Intersection found.
 Depending on the position of the content relative to the context (i.e. 'direction'),
 shift the box so that it doesn't intersect and then restart the loop.
 The loop should end when all obstacles have been checked or it has been determined
 that no placement is possible without intersecting an obstacle.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">function</span> <span class="nx">_getBestPositionInRange</span><span class="p">(</span><span class="nx">minPos</span><span class="p">,</span> <span class="nx">maxPos</span><span class="p">,</span> <span class="nx">contentSize</span><span class="p">,</span> <span class="nx">offset</span><span class="p">,</span> <span class="nx">nextObstacle</span><span class="p">)</span> <span class="p">{</span>
            <span class="cm">/*</span>
<span class="cm">             * For each object { pos, size } in nextObstacle:</span>
<span class="cm">             *  For each range in ranges:</span>
<span class="cm">             *      if (pos &lt;= range.min)</span>
<span class="cm">             *          if (pos + size &gt; range.min)</span>
<span class="cm">             *              range.min = Math.max(range.min, pos+size);</span>
<span class="cm">             *          else no overlap</span>
<span class="cm">             *      else (pos &gt; range.min)</span>
<span class="cm">             *          if (pos + size &gt;= range.max)</span>
<span class="cm">             *              range.max = Math.min(rang.max, pos);</span>
<span class="cm">             *          else (pos + size &lt; range.max)</span>
<span class="cm">             *              //SPLIT the range</span>
<span class="cm">             *              range1.min = range.min;</span>
<span class="cm">             *              range1.max = pos;</span>
<span class="cm">             *              range2.min = pos + size;</span>
<span class="cm">             *              range2.max = range.max;</span>
<span class="cm">             *              //delete/replace old range from ranges[]</span>
<span class="cm">             *              //add new range(s) to ranges[]</span>
<span class="cm">             *      else no overlap</span>
<span class="cm">             *</span>
<span class="cm">             *      if (range.min &gt;= range.max)</span>
<span class="cm">             *          delete range from ranges[]</span>
<span class="cm">             *          if (ranges.length === 0)</span>
<span class="cm">             *              //no possible position</span>
<span class="cm">             *              return null;</span>
<span class="cm">             *</span>
<span class="cm">             * //reduced all ranges by checking all obstacles</span>
<span class="cm">             * //Now calculate position by choosing the closest to centered over the context</span>
<span class="cm">             *</span>
<span class="cm">             */</span>

            <span class="kd">var</span> <span class="nx">ranges</span> <span class="o">=</span> <span class="p">[{</span>
                <span class="nx">min</span><span class="o">:</span> <span class="nx">minPos</span><span class="p">,</span>
                <span class="nx">max</span><span class="o">:</span> <span class="nx">maxPos</span>
            <span class="p">}];</span>
            <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">obstacleStart</span><span class="p">,</span> <span class="nx">obstacleEnd</span><span class="p">,</span> <span class="nx">range</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">obstacle</span><span class="p">;</span>
            <span class="k">while</span> <span class="p">(</span><span class="nx">ranges</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">obstacle</span> <span class="o">=</span> <span class="nx">nextObstacle</span><span class="p">()))</span> <span class="p">{</span>
                <span class="nx">obstacleStart</span> <span class="o">=</span> <span class="nx">obstacle</span><span class="p">.</span><span class="nx">pos</span> <span class="o">-</span> <span class="p">(</span><span class="nx">offset</span> <span class="o">+</span> <span class="nx">contentSize</span><span class="p">);</span>
                <span class="nx">obstacleEnd</span> <span class="o">=</span> <span class="nx">obstacle</span><span class="p">.</span><span class="nx">pos</span> <span class="o">+</span> <span class="nx">obstacle</span><span class="p">.</span><span class="nx">size</span> <span class="o">+</span> <span class="nx">offset</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ranges</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">range</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">obstacleStart</span> <span class="o">&lt;=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">min</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">obstacleEnd</span> <span class="o">&gt;</span> <span class="nx">range</span><span class="p">.</span><span class="nx">min</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">range</span><span class="p">.</span><span class="nx">min</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">min</span><span class="p">,</span> <span class="nx">obstacleEnd</span><span class="p">);</span>
                        <span class="p">}</span> <span class="c1">//else no overlap</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>We've seen this intersection before - just give up.</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="k">if</span> <span class="p">(</span><span class="nx">obstacleEnd</span> <span class="o">&gt;=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">max</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">range</span><span class="p">.</span><span class="nx">max</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">max</span><span class="p">,</span> <span class="nx">obstacleStart</span><span class="p">);</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <pre><code>  Example cases:
         ------------
     ____|____ rect |
    |__box____|------
   --------------------
   |     context      |

         ------------
     ____|_____rect_|__
    |__box_____________|
   --------------------
   |     context      |

  Solution:
         ------------
</code></pre>

<p><strong><em>_</em><em>_</strong> |     rect |
  |<strong>box</em>_</strong>|------------
       --------------------
       |     context      |</p>

<pre><code>        OR
         ------------
         |     rect | _________
         ------------|__box____|
   --------------------
   |     context      |
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>                            <span class="kd">var</span> <span class="nx">newRange</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="nx">min</span><span class="o">:</span> <span class="nx">obstacleEnd</span><span class="p">,</span>
                                <span class="nx">max</span><span class="o">:</span> <span class="nx">range</span><span class="p">.</span><span class="nx">max</span>
                            <span class="p">};</span>
                            <span class="nx">range</span><span class="p">.</span><span class="nx">max</span> <span class="o">=</span> <span class="nx">obstacleStart</span><span class="p">;</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">newRange</span><span class="p">.</span><span class="nx">min</span> <span class="o">&lt;</span> <span class="nx">newRange</span><span class="p">.</span><span class="nx">max</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>shift box left if possible</p>             </td>             <td class="code">               <div class="highlight"><pre>                                <span class="nx">ranges</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">newRange</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="k">if</span> <span class="p">(</span><span class="nx">range</span><span class="p">.</span><span class="nx">min</span> <span class="o">&gt;=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">max</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>cannot shift box that far - try other side:</p>             </td>             <td class="code">               <div class="highlight"><pre>                        <span class="nx">ranges</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                        <span class="nx">i</span><span class="o">--</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="kd">var</span> <span class="nx">idealPos</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">newPos</span> <span class="o">=</span> <span class="nx">minPos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">delta</span> <span class="o">=</span> <span class="nb">Number</span><span class="p">.</span><span class="nx">MAX_VALUE</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">rangeDelta</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ranges</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">range</span> <span class="o">=</span> <span class="nx">ranges</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">idealPos</span> <span class="o">&lt;</span> <span class="nx">range</span><span class="p">.</span><span class="nx">min</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>cannot place box in this direction without intersection
stop checking obstacles</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">rangeDelta</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">min</span> <span class="o">-</span> <span class="nx">idealPos</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">rangeDelta</span> <span class="o">&lt;</span> <span class="nx">delta</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">newPos</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">min</span><span class="p">;</span>
                        <span class="nx">delta</span> <span class="o">=</span> <span class="nx">rangeDelta</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">idealPos</span> <span class="o">&gt;</span> <span class="nx">range</span><span class="p">.</span><span class="nx">max</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>update position limits</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">rangeDelta</span> <span class="o">=</span> <span class="nx">idealPos</span> <span class="o">-</span> <span class="nx">range</span><span class="p">.</span><span class="nx">max</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">rangeDelta</span> <span class="o">&lt;</span> <span class="nx">delta</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">newPos</span> <span class="o">=</span> <span class="nx">range</span><span class="p">.</span><span class="nx">max</span><span class="p">;</span>
                        <span class="nx">delta</span> <span class="o">=</span> <span class="nx">rangeDelta</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>update position limits</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">newPos</span> <span class="o">=</span> <span class="nx">idealPos</span><span class="p">;</span>
                    <span class="nx">delta</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">((</span><span class="nx">newPos</span> <span class="o">&lt;</span> <span class="nx">minPos</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">newPos</span> <span class="o">&gt;</span> <span class="nx">maxPos</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <pre><code>  Example cases:
------------
|   rect __|______
--------|__box____|
   --------------------
   |     context      |

--------------------
|   rect ________  |
--------|__box___|--
   --------------------
   |     context      |

  Solution:
------------
|     rect | _________
------------|__box____|
   --------------------
   |     context      |

         OR
         ------------
</code></pre>

<p><strong><em>_</em><em>_</strong> |     rect |
  |<strong>box</em>_</strong>|------------
       --------------------
       |     context      |</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">newPos</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">newPos</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">compensateObstacles2</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">posLimits</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">obstacles</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">minPos</span><span class="p">,</span> <span class="nx">maxPos</span><span class="p">,</span> <span class="nx">newPos</span><span class="p">,</span> <span class="nx">contentSize</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">occupiedRects</span> <span class="o">=</span> <span class="nx">obstacles</span><span class="p">.</span><span class="nx">slice</span><span class="p">();</span> <span class="c1">//copy obstacles array so that we may modify it</span>
            <span class="k">if</span> <span class="p">(((</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;east&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;west&#39;</span><span class="p">)))</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minX</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">horizontal</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">right</span> <span class="o">=</span> <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minX</span> <span class="o">+</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">horizontal</span><span class="p">;</span>
                <span class="nx">minPos</span> <span class="o">=</span> <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minY</span><span class="p">;</span>
                <span class="nx">maxPos</span> <span class="o">=</span> <span class="nx">posLimits</span><span class="p">.</span><span class="nx">maxY</span><span class="p">;</span>
                <span class="nx">contentSize</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">height</span> <span class="o">&gt;</span> <span class="nx">context</span><span class="p">.</span><span class="nx">height</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>shift box right if possible</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">occupiedRects</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{</span>
                        <span class="nx">left</span><span class="o">:</span> <span class="nx">left</span><span class="p">,</span>
                        <span class="nx">width</span><span class="o">:</span> <span class="nx">right</span> <span class="o">-</span> <span class="nx">left</span><span class="p">,</span>
                        <span class="nx">top</span><span class="o">:</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span>
                        <span class="nx">height</span><span class="o">:</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">context</span><span class="p">.</span><span class="nx">height</span>
                    <span class="p">});</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">newPos</span> <span class="o">=</span> <span class="nx">_getBestPositionInRange</span><span class="p">(</span><span class="nx">minPos</span><span class="p">,</span> <span class="nx">maxPos</span><span class="p">,</span> <span class="nx">contentSize</span><span class="p">,</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">vertical</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>cannot shift box that far - try other side:</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="kd">var</span> <span class="nx">next</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">rect</span><span class="p">;</span>
                    <span class="k">for</span> <span class="p">(;</span> <span class="o">!</span><span class="nx">next</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">occupiedRects</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">rect</span> <span class="o">=</span> <span class="nx">occupiedRects</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                        <span class="k">if</span> <span class="p">((</span><span class="nx">rect</span><span class="p">.</span><span class="nx">left</span> <span class="o">&lt;=</span> <span class="nx">right</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;=</span> <span class="nx">left</span><span class="p">))</span> <span class="p">{</span>
                            <span class="nx">next</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="nx">pos</span><span class="o">:</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span>
                                <span class="nx">size</span><span class="o">:</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">height</span>
                            <span class="p">};</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="nx">next</span><span class="p">;</span>
                <span class="p">});</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">newPos</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minX</span><span class="p">;</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">newPos</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minX</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minY</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">top</span> <span class="o">=</span> <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minY</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">vertical</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">bottom</span> <span class="o">=</span> <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minY</span> <span class="o">+</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">vertical</span><span class="p">;</span>
                <span class="nx">minPos</span> <span class="o">=</span> <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minX</span><span class="p">;</span>
                <span class="nx">maxPos</span> <span class="o">=</span> <span class="nx">posLimits</span><span class="p">.</span><span class="nx">maxX</span><span class="p">;</span>
                <span class="nx">contentSize</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;</span> <span class="nx">context</span><span class="p">.</span><span class="nx">width</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>cannot place box in this direction without intersection
stop checking obstacles</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">occupiedRects</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{</span>
                        <span class="nx">top</span><span class="o">:</span> <span class="nx">top</span><span class="p">,</span>
                        <span class="nx">height</span><span class="o">:</span> <span class="nx">bottom</span> <span class="o">-</span> <span class="nx">top</span><span class="p">,</span>
                        <span class="nx">left</span><span class="o">:</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span>
                        <span class="nx">width</span><span class="o">:</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">context</span><span class="p">.</span><span class="nx">width</span>
                    <span class="p">});</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>update position limits</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">newPos</span> <span class="o">=</span> <span class="nx">_getBestPositionInRange</span><span class="p">(</span><span class="nx">minPos</span><span class="p">,</span> <span class="nx">maxPos</span><span class="p">,</span> <span class="nx">contentSize</span><span class="p">,</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">horizontal</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>update position limits</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="kd">var</span> <span class="nx">next</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                    <span class="kd">var</span> <span class="nx">rect</span><span class="p">;</span>
                    <span class="k">for</span> <span class="p">(;</span> <span class="o">!</span><span class="nx">next</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">occupiedRects</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">rect</span> <span class="o">=</span> <span class="nx">occupiedRects</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                        <span class="k">if</span> <span class="p">((</span><span class="nx">rect</span><span class="p">.</span><span class="nx">top</span> <span class="o">&lt;=</span> <span class="nx">bottom</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">rect</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">height</span> <span class="o">&gt;=</span> <span class="nx">top</span><span class="p">))</span> <span class="p">{</span>
                            <span class="nx">next</span> <span class="o">=</span> <span class="p">{</span>
                                <span class="nx">pos</span><span class="o">:</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">left</span><span class="p">,</span>
                                <span class="nx">size</span><span class="o">:</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">width</span>
                            <span class="p">};</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                    <span class="k">return</span> <span class="nx">next</span><span class="p">;</span>
                <span class="p">});</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">newPos</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">newPos</span><span class="p">;</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minY</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <pre><code>  Example cases:
    _________   ___
</code></pre>

<p>-----|<strong>box<em>_</strong>| |
  | rect     |     |
  ------------     | context
                   |
                   |</em>__</p>

<pre><code>     ________   ___
</code></pre>

<p>------| box    | |
  | rect|        | |
  ------|        | | context
        |<strong><em>_</em><em></strong>| |
                   |</em>__</p>

<pre><code>  Solution:
                ___
    _________  |
   |__box____| |
</code></pre>

<p>------------     | context
  | rect     |     |
  ------------     |<strong>_
         OR
                    <em></strong>
  ------------     |
  | rect     |     |
  ------------     | context
        <strong></em><em>_</em><em></strong>  |
       |<strong>box</em><em></strong>| |
                   |</em>__</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minX</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">posLimits</span><span class="p">.</span><span class="nx">minY</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">calculateMaxPositions</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">limits</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="nx">direction</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;north&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;south&#39;</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>shift box up if possible</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">limits</span><span class="p">.</span><span class="nx">minX</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">limits</span><span class="p">.</span><span class="nx">minX</span><span class="p">,</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">limits</span><span class="p">.</span><span class="nx">maxX</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">((</span><span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">,</span> <span class="nx">limits</span><span class="p">.</span><span class="nx">maxX</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>cannot shift box that far - try other side:</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">limits</span><span class="p">.</span><span class="nx">minY</span> <span class="o">=</span> <span class="nx">limits</span><span class="p">.</span><span class="nx">maxY</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="s1">&#39;east&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;west&#39;</span><span class="o">:</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">limits</span><span class="p">.</span><span class="nx">minY</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">limits</span><span class="p">.</span><span class="nx">minY</span><span class="p">,</span> <span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>cannot place box in this direction without intersection
stop checking obstacles</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">limits</span><span class="p">.</span><span class="nx">maxY</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">((</span><span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">,</span> <span class="nx">limits</span><span class="p">.</span><span class="nx">maxY</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>update position limits</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">limits</span><span class="p">.</span><span class="nx">minX</span> <span class="o">=</span> <span class="nx">limits</span><span class="p">.</span><span class="nx">maxX</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">limits</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">isCornerAdjacent</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">position</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">adjacent</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">switch</span> <span class="p">(</span><span class="nx">direction</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;north&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;south&#39;</span><span class="o">:</span>
                <span class="nx">adjacent</span> <span class="o">=</span> <span class="p">((</span><span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">&gt;=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">&lt;=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">))</span> <span class="o">||</span>
                    <span class="p">((</span><span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span> <span class="o">&lt;=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">content</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">));</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="s1">&#39;east&#39;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s1">&#39;west&#39;</span><span class="o">:</span>
                <span class="nx">adjacent</span> <span class="o">=</span> <span class="p">((</span><span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">&gt;=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">&lt;=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">bottom</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">))</span> <span class="o">||</span>
                    <span class="p">((</span><span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span> <span class="o">&lt;=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">content</span><span class="p">.</span><span class="nx">height</span> <span class="o">&lt;=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">context</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span><span class="p">));</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">adjacent</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">function</span> <span class="nx">_isPointInRange</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span> <span class="nx">maxPositions</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">&gt;=</span> <span class="nx">maxPositions</span><span class="p">.</span><span class="nx">minX</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">position</span><span class="p">.</span><span class="nx">left</span> <span class="o">&lt;=</span> <span class="nx">maxPositions</span><span class="p">.</span><span class="nx">maxX</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                <span class="p">(</span><span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">&gt;=</span> <span class="nx">maxPositions</span><span class="p">.</span><span class="nx">minY</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">position</span><span class="p">.</span><span class="nx">top</span> <span class="o">&lt;=</span> <span class="nx">maxPositions</span><span class="p">.</span><span class="nx">maxY</span><span class="p">);</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>update position limits</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">direction</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">direction</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <pre><code>  Example cases:
                ___
</code></pre>

<p>------------     |
  | rect<strong><em></strong>|<strong></em>  |
  -----|</strong>box<strong><em>_| | context
                   |
                   |</em></strong></p>

<pre><code>                ___
</code></pre>

<p>------------     |
  | rect<strong><em></strong>|<strong></em>  |
  |    |</strong>box<strong><em>_| | context
  |          |     |
  ------------     |</em></strong></p>

<pre><code>  Solution:
                ___
</code></pre>

<p>------------     |
  | rect     |     |
  ------------     | context
        <strong><em>_</em><em>_</strong>  |
       |<strong>box</em><em></strong>| |
                   |</em>__</p>

<pre><code>     OR
                ___
    _________  |
   |__box____| |
</code></pre>

<p>------------     | context
  | rect     |     |
  ------------     |<em>_</em></p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">direction</span> <span class="k">in</span> <span class="nx">nextDirection</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">direction</span> <span class="o">=</span> <span class="s1">&#39;north&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">originalDirection</span> <span class="o">=</span> <span class="nx">direction</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>shift box down if possible</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">var</span> <span class="nx">origMinX</span><span class="p">,</span> <span class="nx">origMinY</span><span class="p">,</span> <span class="nx">origMaxX</span><span class="p">,</span> <span class="nx">origMaxY</span><span class="p">;</span>
        <span class="nx">origMinX</span> <span class="o">=</span> <span class="nx">origMinY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">origMaxX</span> <span class="o">=</span> <span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
        <span class="nx">origMaxY</span> <span class="o">=</span> <span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">container</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">origMinX</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">container</span><span class="p">;</span>
            <span class="nx">origMinY</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">container</span><span class="p">;</span>
            <span class="nx">origMaxX</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">container</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">container</span><span class="p">;</span>
            <span class="nx">origMaxY</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">container</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">container</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">viewport</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">origMinX</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">offsets</span><span class="p">.</span><span class="nx">viewport</span><span class="p">,</span> <span class="nx">origMinX</span><span class="p">);</span>
            <span class="nx">origMinY</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">offsets</span><span class="p">.</span><span class="nx">viewport</span><span class="p">,</span> <span class="nx">origMinY</span><span class="p">);</span>
            <span class="nx">origMaxX</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">viewport</span><span class="p">,</span> <span class="nx">origMaxX</span><span class="p">);</span>
            <span class="nx">origMaxY</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">viewport</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">viewport</span><span class="p">,</span> <span class="nx">origMaxY</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">maxBounds</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">content</span> <span class="o">=</span> <span class="nx">getContentSize</span><span class="p">(</span><span class="nx">direction</span><span class="p">);</span>
            <span class="nx">attemptDirection</span><span class="p">(</span><span class="nx">direction</span><span class="p">);</span>
            <span class="nx">maxBounds</span> <span class="o">=</span> <span class="nx">calculateMaxPositions</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">minX</span><span class="o">:</span> <span class="nx">origMinX</span><span class="p">,</span>
                <span class="nx">minY</span><span class="o">:</span> <span class="nx">origMinY</span><span class="p">,</span>
                <span class="nx">maxX</span><span class="o">:</span> <span class="nx">origMaxX</span><span class="p">,</span>
                <span class="nx">maxY</span><span class="o">:</span> <span class="nx">origMaxY</span>
            <span class="p">});</span>
            <span class="nx">compensateContainer</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">maxBounds</span><span class="p">);</span>
            <span class="nx">compensateViewport</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">maxBounds</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">_isPointInRange</span><span class="p">(</span><span class="nx">pos</span><span class="p">,</span> <span class="nx">maxBounds</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">compensateObstacles2</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">maxBounds</span><span class="p">);</span>
            <span class="p">}</span> <span class="c1">//Else skip the most expensive step if the position is already out of the maxBounds limits.</span>
            <span class="kd">var</span> <span class="nx">box</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">content</span><span class="p">,</span> <span class="nx">pos</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_isPointInRange</span><span class="p">(</span><span class="nx">pos</span><span class="p">,</span> <span class="nx">maxBounds</span><span class="p">)</span> <span class="o">||</span>
                <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">cornerAdjacent</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">isCornerAdjacent</span><span class="p">(</span><span class="nx">direction</span><span class="p">,</span> <span class="nx">pos</span><span class="p">))</span> <span class="o">||</span>
                <span class="nx">$</span><span class="p">.</span><span class="nx">doBoundingBoxesIntersect</span><span class="p">(</span><span class="nx">box</span><span class="p">,</span> <span class="nx">context</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>cannot shift box that far - try other side:</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">nextDirection</span><span class="p">[</span><span class="nx">direction</span><span class="p">]</span> <span class="o">===</span> <span class="nx">originalDirection</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>If content corner is required to be adjacent to the context edge, then we adjust if necessary.</p>             </td>             <td class="code">               <div class="highlight"><pre>                    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">giveMeSomething</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>cannot place box in this direction without intersection
stop checking obstacles</p>             </td>             <td class="code">               <div class="highlight"><pre>                <span class="nx">direction</span> <span class="o">=</span> <span class="nx">nextDirection</span><span class="p">[</span><span class="nx">direction</span><span class="p">];</span>
                <span class="k">continue</span><span class="p">;</span>
            <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>update position limits</p>             </td>             <td class="code">               <div class="highlight"><pre>            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>update position limits</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">pos</span><span class="p">.</span><span class="nx">maxWidth</span> <span class="o">=</span> <span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">viewport</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Returns the position in the specified range that avoids all of the obstacles on an axis.
 Returns null if no position is possible without intersection.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;=</span> <span class="nx">viewport</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">pos</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">;</span>
            <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s1">&#39;0px&#39;</span><span class="p">;</span>
            <span class="nx">pos</span><span class="p">.</span><span class="nx">margin</span> <span class="o">=</span> <span class="s1">&#39;0 &#39;</span> <span class="o">+</span> <span class="nx">offsets</span><span class="p">.</span><span class="nx">padding</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">;</span>
            <span class="nx">pos</span><span class="p">.</span><span class="nx">maxWidth</span> <span class="o">=</span> <span class="s1">&#39;100%&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">direction</span><span class="o">:</span> <span class="nx">direction</span><span class="p">,</span>
            <span class="nx">pos</span><span class="o">:</span> <span class="nx">pos</span>
        <span class="p">};</span>
    <span class="p">};</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">doBoundingBoxesIntersect</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">doBoundingBoxesIntersect</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">left</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">b</span><span class="p">.</span><span class="nx">width</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">width</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">left</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">top</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">b</span><span class="p">.</span><span class="nx">height</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">height</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">.</span><span class="nx">top</span><span class="p">);</span>
    <span class="p">};</span>

<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>obstacleStart = range.min</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>obstacle is in the middle of the range
 split the range in two</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>Add new range to list of ranges</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>make sure range is still valid</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>invalid range - remove from ranges array</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Checked all obstacles across the valid position ranges
Now calculate the position closest to the ideal (centered relative to context).</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>ideal position is out of our range</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>ideal position is out of our range</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>ideal position is in our range</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>should only happen if ranges.length === 0 here due to loop over obstacles invalidating all ranges.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Add range that's off limits where the corners won't be adjacent.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>Look for a position in the vertical range</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>iterator that returns a { pos, size } iff it intersects the axis of the range we're interested in</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>no valid position</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>Add range that's off limits where the corners won't be adjacent.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-92">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-92">&#182;</a>               </div>               <p>Look for a position in the horizontal range</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-93">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-93">&#182;</a>               </div>               <p>iterator that returns a { pos, size } iff it intersects the axis of the range we're interested in</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-94">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-94">&#182;</a>               </div>               <p>no valid position</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-95">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-95">&#182;</a>               </div>               <p>minX is full content width to the west of the container</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-96">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-96">&#182;</a>               </div>               <p>maxX is full content width to the east of the container</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-97">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-97">&#182;</a>               </div>               <p>minY and maxY are equal since the content shouldn't be moved vertically</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-98">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-98">&#182;</a>               </div>               <p>minY is as north as the content can get</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-99">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-99">&#182;</a>               </div>               <p>maxX is as south as the content can get</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-100">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-100">&#182;</a>               </div>               <p>minX and maxX shouldn't change</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-101">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-101">&#182;</a>               </div>               <p>attempt the direction requested first</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-102">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-102">&#182;</a>               </div>               <p>Default to "north" if the direction is invalid.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-103">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-103">&#182;</a>               </div>               <p>limits of content in each direction</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-104">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-104">&#182;</a>               </div>               <p>verify position is not over the context and within expected limits</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-105">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-105">&#182;</a>               </div>               <p>check to see if we are about to start over</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-106">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-106">&#182;</a>               </div>               <p>Return null to signify that we could not position this content.</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-107">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-107">&#182;</a>               </div>               <p>try again</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-108">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-108">&#182;</a>               </div>               <p>this direction checks out</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-109">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-109">&#182;</a>               </div>               <p>calculate the max width to ensure the content is not outside viewport</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                               <tr id="section-110">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-110">&#182;</a>               </div>               <p>ensure that the content isn't too large for the viewport</p>             </td>             <td class="code">               <div class="highlight"><pre>undefined</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 