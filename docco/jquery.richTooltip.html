<!DOCTYPE html>  <html> <head>   <title>jquery.richTooltip.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="breakpoints.html">                 breakpoints.js               </a>                                           <a class="source" href="date-parse.html">                 date-parse.js               </a>                                           <a class="source" href="jquery.breakpoints.html">                 jquery.breakpoints.js               </a>                                           <a class="source" href="jquery.calcRestrainedPos.html">                 jquery.calcRestrainedPos.js               </a>                                           <a class="source" href="jquery.clientRect.html">                 jquery.clientRect.js               </a>                                           <a class="source" href="jquery.contentSize.html">                 jquery.contentSize.js               </a>                                           <a class="source" href="jquery.cookies.html">                 jquery.cookies.js               </a>                                           <a class="source" href="jquery.css.html">                 jquery.css.js               </a>                                           <a class="source" href="jquery.customEvent.html">                 jquery.customEvent.js               </a>                                           <a class="source" href="jquery.delimitedString.html">                 jquery.delimitedString.js               </a>                                           <a class="source" href="jquery.disableEvent.html">                 jquery.disableEvent.js               </a>                                           <a class="source" href="jquery.hostIframe.html">                 jquery.hostIframe.js               </a>                                           <a class="source" href="jquery.hoverDelay.html">                 jquery.hoverDelay.js               </a>                                           <a class="source" href="jquery.htmlEncode.html">                 jquery.htmlEncode.js               </a>                                           <a class="source" href="jquery.imageSize.html">                 jquery.imageSize.js               </a>                                           <a class="source" href="jquery.isVisibleKeyCode.html">                 jquery.isVisibleKeyCode.js               </a>                                           <a class="source" href="jquery.menu.html">                 jquery.menu.js               </a>                                           <a class="source" href="jquery-menu-exampleskin.html">                 jquery-menu-exampleskin.js               </a>                                           <a class="source" href="jquery.modalDialog.deviceFixes.html">                 jquery.modalDialog.deviceFixes.js               </a>                                           <a class="source" href="jquery.modalDialog.getSettings.html">                 jquery.modalDialog.getSettings.js               </a>                                           <a class="source" href="jquery.modalDialog.header.html">                 jquery.modalDialog.header.js               </a>                                           <a class="source" href="jquery.modalDialog.history.html">                 jquery.modalDialog.history.js               </a>                                           <a class="source" href="jquery.modalDialog.html">                 jquery.modalDialog.js               </a>                                           <a class="source" href="jquery.modalDialog.unobtrusive.html">                 jquery.modalDialog.unobtrusive.js               </a>                                           <a class="source" href="jquery.modalDialog.userAgent.html">                 jquery.modalDialog.userAgent.js               </a>                                           <a class="source" href="jquery.modalDialogContent.header.html">                 jquery.modalDialogContent.header.js               </a>                                           <a class="source" href="jquery.modalDialogContent.html">                 jquery.modalDialogContent.js               </a>                                           <a class="source" href="jquery.msAjax.html">                 jquery.msAjax.js               </a>                                           <a class="source" href="jquery.ns.html">                 jquery.ns.js               </a>                                           <a class="source" href="jquery.partialLoad.html">                 jquery.partialLoad.js               </a>                                           <a class="source" href="jquery.postMessage.html">                 jquery.postMessage.js               </a>                                           <a class="source" href="jquery.proxyAll.html">                 jquery.proxyAll.js               </a>                                           <a class="source" href="jquery.queryString.html">                 jquery.queryString.js               </a>                                           <a class="source" href="jquery.richTooltip.html">                 jquery.richTooltip.js               </a>                                           <a class="source" href="jquery.scrollAnchor.html">                 jquery.scrollAnchor.js               </a>                                           <a class="source" href="jquery.uncomment.html">                 jquery.uncomment.js               </a>                                           <a class="source" href="jquery.url.html">                 jquery.url.js               </a>                                           <a class="source" href="pointy.gestures.html">                 pointy.gestures.js               </a>                                           <a class="source" href="pointy.html">                 pointy.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs"><a href="../index.html">Home</a> | 
<a href="https://github.com/vistaprint/SkinnyJS/blob/master/js/jquery.richTooltip.js" target="_blank">View this file on Github</a>

<hr style="height: 1px; border:0; background-color:#4A525A">
             <h1>               jquery.richTooltip.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>/ <reference path="jquery.clientRect.js" />
/ <reference path="jquery.proxyAll.js" />
/ <reference path="jquery.calcRestrainedPos.js" />
/ <reference path="jquery.hoverDelay.js" /></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">arrowDirections</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">south</span><span class="o">:</span> <span class="s1">&#39;north&#39;</span><span class="p">,</span>
        <span class="nx">north</span><span class="o">:</span> <span class="s1">&#39;south&#39;</span><span class="p">,</span>
        <span class="nx">east</span><span class="o">:</span> <span class="s1">&#39;west&#39;</span><span class="p">,</span>
        <span class="nx">west</span><span class="o">:</span> <span class="s1">&#39;east&#39;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>commonly used array for looping over</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">directions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;north&#39;</span><span class="p">,</span> <span class="s1">&#39;south&#39;</span><span class="p">,</span> <span class="s1">&#39;west&#39;</span><span class="p">,</span> <span class="s1">&#39;east&#39;</span><span class="p">];</span>

    <span class="kd">var</span> <span class="nx">defaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">pos</span><span class="o">:</span> <span class="s1">&#39;south&#39;</span><span class="p">,</span>
        <span class="nx">arrowDirection</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">arrowStyle</span><span class="o">:</span> <span class="s1">&#39;outset&#39;</span>
    <span class="p">};</span>

    <span class="kd">function</span> <span class="nx">Tooltip</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">proxyAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">,</span> <span class="s1">&#39;hide&#39;</span><span class="p">,</span> <span class="s1">&#39;toggle&#39;</span><span class="p">,</span> <span class="s1">&#39;pos&#39;</span><span class="p">,</span> <span class="s1">&#39;unhover&#39;</span><span class="p">,</span> <span class="s1">&#39;onWindowResize&#39;</span><span class="p">,</span> <span class="s1">&#39;onDocumentClick&#39;</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>target context element that initalizes this tooltip</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">context</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;rich-tooltip-context&#39;</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>store options</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">defaults</span><span class="p">,</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{});</span>

</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>determine the content of the tooltip</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">content</span><span class="p">).</span><span class="nx">eq</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;rich-tooltip-content&#39;</span><span class="p">);</span> <span class="c1">// class adds legacy browser support</span>

</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>ensure we actually found the content</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;jquery.richTooltip: failed to find desired tooltip&#39;</span><span class="p">);</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>add functional classes</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;rich-tooltip-pos-&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pos</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>move the content to the body to avoid positioning conflicts</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>configure the context</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;data-rel&#39;</span><span class="p">,</span> <span class="s1">&#39;tooltip&#39;</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>setup the hover events</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">action</span> <span class="o">===</span> <span class="s1">&#39;hover&#39;</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>soft dependency on hoverDelay</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">hoverDelay</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>hover is desktop only, and does not support pointer events</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">hoverDelay</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">unhover</span><span class="p">,</span> <span class="p">{</span> <span class="nx">delayOver</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span> <span class="nx">delayOut</span><span class="o">:</span> <span class="mi">500</span><span class="p">,</span> <span class="nx">addChildren</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">content</span> <span class="p">});</span>

</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>hover over the tooltip content should not hide the tooltip yet</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">hoverDelay</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">unhover</span><span class="p">,</span> <span class="p">{</span> <span class="nx">delayOver</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span> <span class="nx">delayOut</span><span class="o">:</span> <span class="mi">500</span><span class="p">,</span> <span class="nx">addChildren</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span> <span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>hover is desktop only, and does not support pointer events</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">hover</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">unhover</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>hover over the tooltip content should not hide the tooltip yet</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">hover</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">unhover</span><span class="p">);</span>
            <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>timestamp of last touch event, used to determine if we should preventDefault on the next click event</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="kd">var</span> <span class="nx">ignoreNextClick</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

            <span class="kd">var</span> <span class="nx">checkEvent</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>if this is a touch type event, then record it</p>             </td>             <td class="code">               <div class="highlight"><pre>
                <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">pointerType</span> <span class="o">===</span> <span class="s1">&#39;touch&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">ignoreNextClick</span> <span class="o">=</span> <span class="o">+</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">());</span>
                <span class="p">}</span>
            <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>listen to pointer down and record the event to be used on click
calling prevent default on pointerup/pointerdown does not
prevent navigation, preventDefault must happen within click event</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">on</span><span class="p">({</span>
                <span class="s1">&#39;pointerdown&#39;</span><span class="o">:</span> <span class="nx">checkEvent</span><span class="p">,</span>
                <span class="s1">&#39;pointerup&#39;</span><span class="o">:</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">checkEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>toggle visibility on touches</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">pointerType</span> <span class="o">===</span> <span class="s1">&#39;touch&#39;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">},</span> <span class="k">this</span><span class="p">)</span>
            <span class="p">});</span>

</pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>listen to clicks, and call prevent default on touch devices</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">ignoreNextClick</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>calculate time delta between last touch event and now</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="kd">var</span> <span class="nx">timeDiff</span> <span class="o">=</span> <span class="o">+</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">())</span> <span class="o">-</span> <span class="nx">ignoreNextClick</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>ignore all clicks for a period of time after the last touch event,
we could ignore all future click events as well, except some devices
have mice and touch screens so this allows for both to work.</p>             </td>             <td class="code">               <div class="highlight"><pre>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">timeDiff</span> <span class="o">&lt;</span> <span class="mi">2500</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
                        <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span> <span class="c1">// do not let this trickle up to the document</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>when hover is off, we simply toggle on click event</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">toggle</span><span class="p">);</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>find the container element</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">container</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">container</span> <span class="o">?</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">container</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>look for exiting arrow</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">arrow</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.rich-tooltip-arrow&#39;</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>no arrow found, create one</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">arrow</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">arrow</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;rich-tooltip-arrow&quot;&gt;&lt;div class=&quot;hack&quot; /&gt;&lt;/div&gt;&#39;</span><span class="p">).</span><span class="nx">appendTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">);</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>anything with [data-rel="close"] can be used to close the tooltip</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;[data-rel=&quot;close&quot;]&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">Tooltip</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unhover</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_clearHoverTimeout</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">hoverTimeout</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">,</span> <span class="mi">250</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">Tooltip</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_clearHoverTimeout</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hoverTimeout</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hoverTimeout</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">hoverTimeout</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nx">Tooltip</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_clearHoverTimeout</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>ensure all other tooltips and other overlay controls are closed</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;closeEverything&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">pos</span><span class="p">();</span>

</pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>mark the tooltip as visible</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>indicate to the context the tooltip is open</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;rich-tooltip-open&#39;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;richTooltip:open&#39;</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">viewportSize</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">height</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">height</span><span class="p">(),</span>
            <span class="nx">width</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">width</span><span class="p">()</span>
        <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>hide the tooltip if the browser resizes, the user can open it back up easily</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onWindowResize</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>$(window).one('scroll', this.hide);</p>             </td>             <td class="code">               <div class="highlight"><pre>

</pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>hide the tooltip if user clicks outside of the tooltip</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onDocumentClick</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">one</span><span class="p">(</span><span class="s1">&#39;closeEverything&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">.</span><span class="nx">proxy</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">item</span> <span class="o">!==</span> <span class="k">this</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">));</span>
    <span class="p">};</span>

    <span class="nx">Tooltip</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hide</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_clearHoverTimeout</span><span class="p">();</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>

</pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>mark the tooltip as not visible</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

</pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>indicate to the context the tooltip is now closed</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;rich-tooltip-open&#39;</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;richTooltip:close&#39;</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>remove event listeners</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onWindowResize</span><span class="p">);</span>
</pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>$(window).off('scroll', this.hide);</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onDocumentClick</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;closeEverything&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">Tooltip</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toggle</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

</pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>we need to call stop propagation or else this will trigger
up to the document and result in closing the tooltip.</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">event</span><span class="p">.</span><span class="nx">stopPropagation</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">visible</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>on window resize, confirm the window actually changed sizes
IE9 and below triggers a resize on any element changing size,
this includes elements becoming visible or hidding
@see http://stackoverflow.com/questions/1852751/window-resize-event-firing-in-internet-explorer</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">Tooltip</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">onWindowResize</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewportSize</span><span class="p">.</span><span class="nx">height</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">width</span><span class="p">()</span> <span class="o">!=</span> <span class="k">this</span><span class="p">.</span><span class="nx">viewportSize</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>on a document click event, we close the tooltip is the click
was not to the tooltip or a child of the tooltip</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">Tooltip</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">onDocumentClick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">target</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">target</span><span class="p">.</span><span class="nx">isChildOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>padding constant used during position calculations</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">PADDING</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">ARROW_WIDTH</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>

    <span class="nx">Tooltip</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pos</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

</pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>find the size of the arrow
.css-arrow elements do not have a size itself because it uses :before and :after</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="kd">var</span> <span class="nx">arrowSize</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">arrowStyle</span> <span class="o">===</span> <span class="s1">&#39;inset&#39;</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">arrow</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="nx">ARROW_WIDTH</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">restrainedPos</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">calcRestrainedPos</span><span class="p">({</span>
            <span class="nx">giveMeSomething</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">direction</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pos</span><span class="p">,</span>
            <span class="nx">content</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;max-width&#39;</span><span class="p">,</span> <span class="s1">&#39;100%&#39;</span><span class="p">),</span>
            <span class="nx">context</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span>
            <span class="nx">container</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">container</span><span class="p">,</span>
            <span class="nx">reset</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">margin</span><span class="o">:</span> <span class="mi">0</span>
            <span class="p">},</span>
            <span class="nx">offsets</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">viewport</span><span class="o">:</span> <span class="nx">PADDING</span><span class="p">,</span>
                <span class="nx">vertical</span><span class="o">:</span> <span class="nx">arrowSize</span><span class="p">,</span>
                <span class="nx">horizontal</span><span class="o">:</span> <span class="nx">arrowSize</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">restrainedPos</span><span class="p">.</span><span class="nx">pos</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">contextRect</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">clientRect</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">arrowPos</span> <span class="o">=</span> <span class="p">{};</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">restrainedPos</span><span class="p">.</span><span class="nx">direction</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pos</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">content</span>
                <span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;rich-tooltip-pos-&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">pos</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;rich-tooltip-pos-&#39;</span> <span class="o">+</span> <span class="nx">restrainedPos</span><span class="p">.</span><span class="nx">direction</span><span class="p">);</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>determine the new arrow direction</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="kd">var</span> <span class="nx">arrowDirection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">arrowDirection</span> <span class="o">||</span> <span class="nx">arrowDirections</span><span class="p">[</span><span class="nx">restrainedPos</span><span class="p">.</span><span class="nx">direction</span><span class="p">];</span>

</pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>position the arrow for top and bottom</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">restrainedPos</span><span class="p">.</span><span class="nx">direction</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;north&#39;</span><span class="o">:</span>
        <span class="k">case</span> <span class="s1">&#39;south&#39;</span><span class="o">:</span>
            <span class="nx">arrowPos</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="nx">contextRect</span><span class="p">.</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="p">(</span><span class="nx">contextRect</span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nx">ARROW_WIDTH</span><span class="p">;</span>
            <span class="nx">arrowPos</span><span class="p">[</span><span class="nx">restrainedPos</span><span class="p">.</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;north&#39;</span> <span class="o">?</span> <span class="s1">&#39;bottom&#39;</span> <span class="o">:</span> <span class="s1">&#39;top&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="s1">&#39;east&#39;</span><span class="o">:</span>
        <span class="k">case</span> <span class="s1">&#39;west&#39;</span><span class="o">:</span>
            <span class="nx">arrowPos</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="nx">contextRect</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="p">(</span><span class="nx">contextRect</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nx">ARROW_WIDTH</span><span class="p">;</span>
            <span class="nx">arrowPos</span><span class="p">[</span><span class="nx">restrainedPos</span><span class="p">.</span><span class="nx">direction</span> <span class="o">===</span> <span class="s1">&#39;east&#39;</span> <span class="o">?</span> <span class="s1">&#39;left&#39;</span> <span class="o">:</span> <span class="s1">&#39;right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>if we are changing the default behavior we have to adjust slightly</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">arrowStyle</span> <span class="o">===</span> <span class="s1">&#39;inset&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="nx">arrowDirection</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;north&#39;</span><span class="o">:</span>
                <span class="nx">arrowPos</span><span class="p">.</span><span class="nx">top</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="s1">&#39;east&#39;</span><span class="o">:</span>
                <span class="nx">arrowPos</span><span class="p">.</span><span class="nx">left</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="s1">&#39;south&#39;</span><span class="o">:</span>
                <span class="nx">arrowPos</span><span class="p">.</span><span class="nx">top</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>

            <span class="k">case</span> <span class="s1">&#39;west&#39;</span><span class="o">:</span>
                <span class="nx">arrowPos</span><span class="p">.</span><span class="nx">left</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">pos</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">arrow</span>
</pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>remove any previously added tooltip arrow direction class</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">directions</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
</pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>add the tooltip arrow direction class</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">arrowDirection</span><span class="p">)</span>
</pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>assign the new arrow styling</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="nx">arrowPos</span><span class="p">);</span>
    <span class="p">};</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">tooltip</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">richTooltip</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">jQueryTooltip</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">tooltip</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;__tooltip&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">tooltip</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">tooltip</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Tooltip</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
            <span class="nx">el</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;__tooltip&#39;</span><span class="p">,</span> <span class="nx">tooltip</span><span class="p">);</span>
        <span class="p">}</span>

</pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>allow this to be used to run methods on the tooltips</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">options</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span> <span class="k">in</span> <span class="nx">tooltip</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">tooltip</span><span class="p">[</span><span class="nx">options</span><span class="p">]();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">isChildOf</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">jQueryIsChildOf</span><span class="p">(</span><span class="nx">filter_string</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">parents</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">parents</span><span class="p">();</span>

        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">parents</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">parents</span><span class="p">[</span><span class="nx">j</span><span class="p">]).</span><span class="nx">is</span><span class="p">(</span><span class="nx">filter_string</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span>

</pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>initialize all existing tooltips</p>             </td>             <td class="code">               <div class="highlight"><pre>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;[data-rel=&quot;tooltip&quot;] + aside&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span> <span class="c1">// this is the aside</span>
            <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">prev</span><span class="p">();</span> <span class="c1">// element prior to aside</span>
            <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">data</span><span class="p">();</span>

</pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>translate data attributes to options</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">context</span><span class="p">.</span><span class="nx">richTooltip</span><span class="p">({</span>
                <span class="nx">content</span><span class="o">:</span> <span class="nx">content</span><span class="p">,</span>
                <span class="nx">action</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">tooltipAction</span> <span class="o">||</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span>
                <span class="nx">pos</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">tooltipPos</span> <span class="o">||</span> <span class="s1">&#39;south&#39;</span><span class="p">,</span>
                <span class="nx">container</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">tooltipContainer</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">,</span>
                <span class="nx">arrowDirection</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">tooltipArrowDirection</span> <span class="o">||</span> <span class="kc">null</span><span class="p">,</span>
                <span class="nx">arrowStyle</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">tooltipArrowStyle</span> <span class="o">||</span> <span class="kc">null</span>
            <span class="p">});</span>
        <span class="p">});</span>

</pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>allow instances without the <aside> directly after the context</p>             </td>             <td class="code">               <div class="highlight"><pre>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;[data-tooltip]&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">data</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">tooltip</span><span class="p">);</span>

</pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>translate data attributes to options</p>             </td>             <td class="code">               <div class="highlight"><pre>
            <span class="nx">context</span><span class="p">.</span><span class="nx">richTooltip</span><span class="p">({</span>
                <span class="nx">content</span><span class="o">:</span> <span class="nx">content</span><span class="p">,</span>
                <span class="nx">action</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">tooltipAction</span> <span class="o">||</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span>
                <span class="nx">pos</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">tooltipPos</span> <span class="o">||</span> <span class="s1">&#39;south&#39;</span><span class="p">,</span>
                <span class="nx">container</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">tooltipContainer</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">,</span>
                <span class="nx">arrowDirection</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">tooltipArrowDirection</span> <span class="o">||</span> <span class="kc">null</span><span class="p">,</span>
                <span class="nx">arrowStyle</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">tooltipArrowStyle</span> <span class="o">||</span> <span class="kc">null</span>
            <span class="p">});</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 